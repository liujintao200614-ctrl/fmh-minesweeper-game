<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FMH‰ª£Â∏ÅÁÆ°ÁêÜÈù¢Êùø Pro - Êô∫ËÉΩÈí±ÂåÖËøûÊé•</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 24px;
            box-shadow: 0 32px 64px rgba(0,0,0,0.15);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 3em;
            margin-bottom: 12px;
            font-weight: 700;
        }
        
        .content { padding: 40px; }
        
        /* Êô∫ËÉΩËøûÊé•Èù¢ÊùøÊ†∑Âºè */
        .wallet-connection-panel {
            background: linear-gradient(135deg, #f8f9fd 0%, #e9ecef 100%);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
            position: relative;
            overflow: hidden;
        }
        
        .connection-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .connection-header h2 {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .connection-header p {
            color: #6b7280;
            font-size: 1.1em;
        }
        
        /* ËøûÊé•Áä∂ÊÄÅÊåáÁ§∫Âô® */
        .connection-status {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 160px;
            justify-content: center;
        }
        
        .status-indicator.checking {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            animation: pulse 2s infinite;
        }
        
        .status-indicator.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .status-indicator.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .status-indicator.pending {
            background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
            color: #6b7280;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }
        
        .status-dot.animate {
            animation: blink 1s infinite;
        }
        
        /* ËØ¶ÁªÜËØäÊñ≠Èù¢Êùø */
        .diagnostic-panel {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #e5e7eb;
            display: none;
        }
        
        .diagnostic-panel.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }
        
        .diagnostic-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .diagnostic-item:last-child {
            border-bottom: none;
        }
        
        .diagnostic-label {
            color: #374151;
            font-weight: 500;
        }
        
        .diagnostic-value {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .diagnostic-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        
        .diagnostic-icon.success {
            background: #10b981;
        }
        
        .diagnostic-icon.error {
            background: #ef4444;
        }
        
        .diagnostic-icon.loading {
            background: #fbbf24;
            animation: spin 1s linear infinite;
        }
        
        /* ËøûÊé•ÊåâÈíÆ */
        .connect-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 48px;
            border-radius: 50px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
            min-width: 200px;
        }
        
        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(102, 126, 234, 0.4);
        }
        
        .connect-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .connect-btn .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        .connect-btn.loading .loading-spinner {
            display: inline-block;
        }
        
        /* ÈîôËØØËß£ÂÜ≥ÊñπÊ°àÈù¢Êùø */
        .solution-panel {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 1px solid #fbbf24;
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }
        
        .solution-panel.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }
        
        .solution-title {
            color: #92400e;
            font-weight: 700;
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        
        .solution-steps {
            list-style: none;
            padding: 0;
        }
        
        .solution-steps li {
            color: #92400e;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }
        
        .solution-steps li:before {
            content: 'üìù';
            position: absolute;
            left: 0;
        }
        
        /* ÂÆûÊó∂Êó•ÂøóÈù¢Êùø */
        .log-panel {
            background: #1f2937;
            color: #d1d5db;
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
        
        .log-panel.show {
            display: block;
        }
        
        .log-entry {
            margin-bottom: 4px;
            padding: 2px 0;
        }
        
        .log-entry.info { color: #60a5fa; }
        .log-entry.success { color: #34d399; }
        .log-entry.warning { color: #fbbf24; }
        .log-entry.error { color: #f87171; }
        
        /* Âä®Áîª */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Â∑•ÂÖ∑ÊåâÈíÆ */
        .tool-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .tool-btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background: white;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9em;
        }
        
        .tool-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }
        
        .hidden { display: none; }
        
        /* ÁÆ°ÁêÜÈù¢ÊùøÊ†∑Âºè */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 12px 24px rgba(0,0,0,0.1);
            border: 1px solid #f0f0f0;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .card h3 {
            color: #2c3e50;
            margin-bottom: 24px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }
        
        .card-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }
        
        .icon-mint { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .icon-burn { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .icon-permission { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .icon-query { background: linear-gradient(135deg, #c3cfe2 0%, #c3cfe2 100%); }
        .icon-settings { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: #f9fafb;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 12px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }
        
        .btn-danger:hover {
            box-shadow: 0 6px 16px rgba(255, 107, 107, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }
        
        .status {
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            font-weight: 500;
            border-left: 4px solid;
        }
        
        .status.success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border-color: #28a745;
        }
        
        .status.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f1aeb5 100%);
            color: #721c24;
            border-color: #dc3545;
        }
        
        .status.info {
            background: linear-gradient(135deg, #d1ecf1 0%, #b8daff 100%);
            color: #0c5460;
            border-color: #17a2b8;
        }
        
        .status.warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
            border-color: #ffc107;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }
        
        .info-item {
            background: linear-gradient(135deg, #f8f9fd 0%, #e9ecef 100%);
            padding: 24px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        
        .info-item .value {
            font-size: 1.8em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .info-item .label {
            color: #6b7280;
            font-size: 0.9em;
            font-weight: 500;
        }
        
        .batch-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e9ecef;
        }
        
        .batch-item {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            align-items: center;
        }
        
        .batch-item input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .batch-controls {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 0.9em;
            width: auto;
            margin: 0;
        }
        
        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 16px;
            }
            
            .content {
                padding: 20px;
            }
            
            .connection-status {
                flex-direction: column;
                gap: 10px;
            }
            
            .status-indicator {
                min-width: auto;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåü FMH‰ª£Â∏ÅÁÆ°ÁêÜÈù¢Êùø Pro</h1>
            <p>Intelligent Wallet Connection & Management Dashboard</p>
        </div>
        
        <div class="content">
            <!-- Êô∫ËÉΩÈí±ÂåÖËøûÊé•Èù¢Êùø -->
            <div class="wallet-connection-panel">
                <div class="connection-header">
                    <h2>üîó Êô∫ËÉΩÈí±ÂåÖËøûÊé•Á≥ªÁªü</h2>
                    <p>ÂÆûÊó∂Ê£ÄÊµã„ÄÅÊô∫ËÉΩËØäÊñ≠„ÄÅ‰∏ÄÈîÆËß£ÂÜ≥</p>
                </div>
                
                <!-- ËøûÊé•Áä∂ÊÄÅÊåáÁ§∫Âô® -->
                <div class="connection-status">
                    <div class="status-indicator pending" id="browserStatus">
                        <div class="status-dot"></div>
                        <span>ÊµèËßàÂô®Ê£ÄÊµã</span>
                    </div>
                    <div class="status-indicator pending" id="metamaskStatus">
                        <div class="status-dot"></div>
                        <span>MetaMaskÊ£ÄÊµã</span>
                    </div>
                    <div class="status-indicator pending" id="networkStatus">
                        <div class="status-dot"></div>
                        <span>ÁΩëÁªúËøûÊé•</span>
                    </div>
                    <div class="status-indicator pending" id="contractStatus">
                        <div class="status-dot"></div>
                        <span>ÂêàÁ∫¶È™åËØÅ</span>
                    </div>
                </div>
                
                <!-- ËøûÊé•ÊåâÈíÆ -->
                <div style="text-align: center;">
                    <button class="connect-btn" id="connectBtn" onclick="startSmartConnection()">
                        <div class="loading-spinner"></div>
                        <span>üöÄ Êô∫ËÉΩËøûÊé•Èí±ÂåÖ</span>
                    </button>
                </div>
                
                <!-- Â∑•ÂÖ∑ÊåâÈíÆ -->
                <div class="tool-buttons">
                    <button class="tool-btn" onclick="toggleDiagnostics()">üìä ËØ¶ÁªÜËØäÊñ≠</button>
                    <button class="tool-btn" onclick="toggleLogs()">üìù ÂÆûÊó∂Êó•Âøó</button>
                    <button class="tool-btn" onclick="showWalletDetectionReport()">üîç Èí±ÂåÖÊ£ÄÊµãÊä•Âëä</button>
                    <button class="tool-btn" onclick="forceUseMetaMaskNow()">ü¶ä Âº∫Âà∂MetaMask</button>
                    <button class="tool-btn" onclick="resetConnection()">üîÑ ÈáçÁΩÆËøûÊé•</button>
                    <button class="tool-btn" onclick="downloadReport()">üìã ÂØºÂá∫Êä•Âëä</button>
                </div>
                
                <!-- ËØ¶ÁªÜËØäÊñ≠Èù¢Êùø -->
                <div class="diagnostic-panel" id="diagnosticPanel">
                    <h3 style="color: #374151; margin-bottom: 15px;">üîç Á≥ªÁªüËØäÊñ≠ËØ¶ÊÉÖ</h3>
                    <div id="diagnosticContent">
                        <!-- Âä®ÊÄÅÁîüÊàêËØäÊñ≠ÂÜÖÂÆπ -->
                    </div>
                </div>
                
                <!-- Ëß£ÂÜ≥ÊñπÊ°àÈù¢Êùø -->
                <div class="solution-panel" id="solutionPanel">
                    <div class="solution-title" id="solutionTitle">üí° ÈóÆÈ¢òËß£ÂÜ≥ÊñπÊ°à</div>
                    <ul class="solution-steps" id="solutionSteps">
                        <!-- Âä®ÊÄÅÁîüÊàêËß£ÂÜ≥Ê≠•È™§ -->
                    </ul>
                </div>
                
                <!-- Èí±ÂåÖÊ£ÄÊµãÊä•ÂëäÈù¢Êùø -->
                <div class="diagnostic-panel" id="walletDetectionPanel">
                    <h3 style="color: #374151; margin-bottom: 15px;">üîç Èí±ÂåÖÊèí‰ª∂Ê£ÄÊµãËØ¶ÁªÜÊä•Âëä</h3>
                    <div id="walletDetectionContent">
                        <!-- Âä®ÊÄÅÁîüÊàêÈí±ÂåÖÊ£ÄÊµãÂÜÖÂÆπ -->
                    </div>
                </div>
                
                <!-- ÂÆûÊó∂Êó•ÂøóÈù¢Êùø -->
                <div class="log-panel" id="logPanel">
                    <div style="color: #fbbf24; margin-bottom: 10px; font-weight: bold;">üîç ÂÆûÊó∂ËøûÊé•Êó•Âøó</div>
                    <div id="logContent">
                        <!-- Âä®ÊÄÅÁîüÊàêÊó•ÂøóÂÜÖÂÆπ -->
                    </div>
                </div>
            </div>
            
            <!-- ÁÆ°ÁêÜÂäüËÉΩÈù¢ÊùøÔºàËøûÊé•ÊàêÂäüÂêéÊòæÁ§∫Ôºâ-->
            <div id="mainPanel" class="hidden">
                <!-- ËøûÊé•ÊàêÂäüÁä∂ÊÄÅÊòæÁ§∫ -->
                <div style="text-align: center; padding: 30px; background: linear-gradient(135deg, #d4f1d4 0%, #a7f3a7 100%); border-radius: 20px; margin-bottom: 30px;">
                    <h2 style="color: #15803d; margin-bottom: 15px;">‚úÖ Èí±ÂåÖËøûÊé•ÊàêÂäüÔºÅ</h2>
                    <p style="color: #166534; font-size: 1em;" id="connectedWalletInfo">Ê≠£Âú®Âä†ËΩΩÈí±ÂåÖ‰ø°ÊÅØ...</p>
                </div>

                <!-- ÂêàÁ∫¶Áä∂ÊÄÅÊ¶ÇËßà -->
                <div class="card">
                    <h3>
                        <span class="card-icon icon-query">üìä</span>
                        ÂêàÁ∫¶Áä∂ÊÄÅÊ¶ÇËßà
                    </h3>
                    <button class="btn btn-secondary" onclick="refreshContractInfo()">üîÑ Âà∑Êñ∞ÊâÄÊúâ‰ø°ÊÅØ</button>
                    <div id="contractInfo"></div>
                </div>
                
                <div class="grid">
                    <!-- Èì∏Â∏ÅÈù¢Êùø -->
                    <div class="card">
                        <h3>
                            <span class="card-icon icon-mint">üè≠</span>
                            Èì∏ÈÄ†‰ª£Â∏Å
                        </h3>
                        <div class="form-group">
                            <label>Êé•Êî∂Âú∞ÂùÄ:</label>
                            <input type="text" id="mintToAddress" placeholder="ËæìÂÖ•Êé•Êî∂‰ª£Â∏ÅÁöÑÈí±ÂåÖÂú∞ÂùÄ (0x...)">
                        </div>
                        <div class="form-group">
                            <label>Èì∏ÈÄ†Êï∞Èáè:</label>
                            <input type="number" id="mintAmount" placeholder="ËæìÂÖ•Èì∏ÈÄ†Êï∞Èáè" min="0" step="0.001">
                        </div>
                        <button class="btn" onclick="mintTokens()">üè≠ ÊâßË°åÈì∏ÈÄ†</button>
                        <div id="mintStatus"></div>
                    </div>
                    
                    <!-- ÂçïÁã¨ÈîÄÊØÅÈù¢Êùø -->
                    <div class="card">
                        <h3>
                            <span class="card-icon icon-burn">üî•</span>
                            ÈîÄÊØÅ‰ª£Â∏Å
                        </h3>
                        <div class="form-group">
                            <label>ÈîÄÊØÅÊñπÂºè:</label>
                            <select id="burnType" onchange="toggleBurnInputs()">
                                <option value="burn">ÈîÄÊØÅËá™Â∑±ÁöÑ‰ª£Â∏Å</option>
                                <option value="burnFrom">ÈîÄÊØÅ‰ªñ‰∫∫ÁöÑ‰ª£Â∏Å</option>
                            </select>
                        </div>
                        <div class="form-group" id="burnFromGroup" style="display: none;">
                            <label>ÁõÆÊ†áÂú∞ÂùÄ:</label>
                            <input type="text" id="burnFromAddress" placeholder="ËæìÂÖ•Ë¶ÅÈîÄÊØÅ‰ª£Â∏ÅÁöÑÂú∞ÂùÄ">
                        </div>
                        <div class="form-group">
                            <label>ÈîÄÊØÅÊï∞Èáè:</label>
                            <input type="number" id="burnAmount" placeholder="ËæìÂÖ•ÈîÄÊØÅÊï∞Èáè" min="0" step="0.001">
                        </div>
                        <button class="btn btn-danger" onclick="burnTokens()">üî• ÊâßË°åÈîÄÊØÅ</button>
                        <div id="burnStatus"></div>
                    </div>
                    
                    <!-- ÊâπÈáèÈîÄÊØÅÈù¢Êùø -->
                    <div class="card">
                        <h3>
                            <span class="card-icon icon-burn">üî•</span>
                            ÊâπÈáèÈîÄÊØÅ‰ª£Â∏Å
                        </h3>
                        <div class="batch-section">
                            <div id="batchBurnList">
                                <div class="batch-item">
                                    <input type="text" placeholder="Âú∞ÂùÄ (0x...)" class="batch-address">
                                    <input type="number" placeholder="Êï∞Èáè" class="batch-amount" min="0" step="0.001">
                                    <button class="btn btn-danger btn-small" onclick="removeBatchItem(this)">Âà†Èô§</button>
                                </div>
                            </div>
                            <div class="batch-controls">
                                <button class="btn btn-secondary btn-small" onclick="addBatchItem()">‚ûï Ê∑ªÂä†È°πÁõÆ</button>
                                <button class="btn btn-danger btn-small" onclick="executeBatchBurn()">üî• ÊâπÈáèÈîÄÊØÅ</button>
                            </div>
                        </div>
                        <div id="batchBurnStatus"></div>
                    </div>
                    
                    <!-- ÊùÉÈôêÁÆ°ÁêÜÈù¢Êùø -->
                    <div class="card">
                        <h3>
                            <span class="card-icon icon-permission">üë•</span>
                            Èì∏Â∏ÅÊùÉÈôêÁÆ°ÁêÜ
                        </h3>
                        <div class="form-group">
                            <label>Ê∑ªÂä†Èì∏Â∏ÅËÄÖ:</label>
                            <input type="text" id="newMinterAddress" placeholder="ËæìÂÖ•Ë¶ÅÊéàÊùÉÁöÑÂú∞ÂùÄ">
                            <button class="btn" onclick="addMinter()">‚ûï Ê∑ªÂä†Èì∏Â∏ÅËÄÖ</button>
                        </div>
                        
                        <div class="form-group">
                            <label>ÁßªÈô§Èì∏Â∏ÅËÄÖ:</label>
                            <input type="text" id="removeMinterAddress" placeholder="ËæìÂÖ•Ë¶ÅÁßªÈô§ÁöÑÂú∞ÂùÄ">
                            <button class="btn btn-danger" onclick="removeMinter()">‚ûñ ÁßªÈô§Èì∏Â∏ÅËÄÖ</button>
                        </div>
                        
                        <div class="form-group">
                            <label>Ê£ÄÊü•ÊùÉÈôê:</label>
                            <input type="text" id="checkMinterAddress" placeholder="ËæìÂÖ•Ë¶ÅÊ£ÄÊü•ÁöÑÂú∞ÂùÄ">
                            <button class="btn btn-secondary" onclick="checkMinterPermission()">üîç Ê£ÄÊü•ÊùÉÈôê</button>
                        </div>
                        
                        <div id="minterStatus"></div>
                    </div>
                    
                    <!-- ‰ª£Â∏ÅÊü•ËØ¢Èù¢Êùø -->
                    <div class="card">
                        <h3>
                            <span class="card-icon icon-query">üîç</span>
                            ‰ª£Â∏ÅÊü•ËØ¢
                        </h3>
                        <div class="form-group">
                            <label>Êü•ËØ¢Âú∞ÂùÄ‰ΩôÈ¢ù:</label>
                            <input type="text" id="queryAddress" placeholder="ËæìÂÖ•Ë¶ÅÊü•ËØ¢ÁöÑÈí±ÂåÖÂú∞ÂùÄ">
                            <button class="btn btn-secondary" onclick="queryBalance()">üí∞ Êü•ËØ¢‰ΩôÈ¢ù</button>
                        </div>
                        
                        <div class="form-group">
                            <label>Êü•ËØ¢ÈîÄÊØÅÁéá:</label>
                            <button class="btn btn-secondary" onclick="getBurnRate()">üìà Ëé∑ÂèñÈîÄÊØÅÁéá</button>
                        </div>
                        
                        <div id="queryResults"></div>
                    </div>
                    
                    <!-- Á≥ªÁªüËÆæÁΩÆÈù¢Êùø -->
                    <div class="card">
                        <h3>
                            <span class="card-icon icon-settings">‚öôÔ∏è</span>
                            Á≥ªÁªüËÆæÁΩÆ
                        </h3>
                        <div class="form-group">
                            <label>ËÆæÁΩÆÊ∏∏ÊàèÂêàÁ∫¶Âú∞ÂùÄ:</label>
                            <input type="text" id="gameContractAddress" placeholder="ËæìÂÖ•Ê∏∏ÊàèÂêàÁ∫¶Âú∞ÂùÄ">
                            <button class="btn" onclick="setGameContract()">‚öôÔ∏è Êõ¥Êñ∞Ê∏∏ÊàèÂêàÁ∫¶</button>
                        </div>
                        
                        <div class="form-group">
                            <label>ÂΩìÂâçÊ∏∏ÊàèÂêàÁ∫¶:</label>
                            <button class="btn btn-secondary" onclick="getCurrentGameContract()">üéÆ Êü•ËØ¢ÂΩìÂâçÊ∏∏ÊàèÂêàÁ∫¶</button>
                        </div>
                        
                        <div id="settingsStatus"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Êô∫ËÉΩÈí±ÂåÖËøûÊé•Á≥ªÁªü
        class SmartWalletConnector {
            constructor() {
                this.diagnostics = {
                    browser: { status: 'pending', message: 'Á≠âÂæÖÊ£ÄÊµã...' },
                    metamask: { status: 'pending', message: 'Á≠âÂæÖÊ£ÄÊµã...' },
                    network: { status: 'pending', message: 'Á≠âÂæÖÊ£ÄÊµã...' },
                    contract: { status: 'pending', message: 'Á≠âÂæÖÊ£ÄÊµã...' }
                };
                this.logs = [];
                this.contract = null;
                this.provider = null;
                this.signer = null;
            }
            
            // Ê∑ªÂä†Êó•Âøó
            addLog(type, message) {
                const timestamp = new Date().toLocaleTimeString();
                this.logs.push({ type, message, timestamp });
                this.updateLogDisplay();
                console.log(`[${timestamp}] ${type.toUpperCase()}: ${message}`);
            }
            
            // Êõ¥Êñ∞Êó•ÂøóÊòæÁ§∫
            updateLogDisplay() {
                const logContent = document.getElementById('logContent');
                if (logContent && this.logs.length > 0) {
                    const recentLogs = this.logs.slice(-20); // Âè™ÊòæÁ§∫ÊúÄËøë20Êù°
                    logContent.innerHTML = recentLogs.map(log => 
                        `<div class="log-entry ${log.type}">[${log.timestamp}] ${log.message}</div>`
                    ).join('');
                    logContent.scrollTop = logContent.scrollHeight;
                }
            }
            
            // Êõ¥Êñ∞Áä∂ÊÄÅÊåáÁ§∫Âô®
            updateStatus(type, status, message = '') {
                this.diagnostics[type] = { status, message };
                const element = document.getElementById(`${type}Status`);
                if (element) {
                    element.className = `status-indicator ${status}`;
                    const dot = element.querySelector('.status-dot');
                    if (dot) {
                        dot.className = status === 'checking' ? 'status-dot animate' : 'status-dot';
                    }
                }
                this.updateDiagnosticPanel();
            }
            
            // Êõ¥Êñ∞ËØäÊñ≠Èù¢Êùø
            updateDiagnosticPanel() {
                const content = document.getElementById('diagnosticContent');
                if (!content) return;
                
                const diagnosticItems = Object.entries(this.diagnostics).map(([key, data]) => {
                    const icon = data.status === 'success' ? 'success' : 
                                data.status === 'error' ? 'error' : 'loading';
                    const label = {
                        browser: 'ÊµèËßàÂô®ÁéØÂ¢É',
                        metamask: 'MetaMask Áä∂ÊÄÅ',
                        network: 'ÁΩëÁªúËøûÊé•',
                        contract: 'ÂêàÁ∫¶È™åËØÅ'
                    }[key];
                    
                    return `
                        <div class="diagnostic-item">
                            <div class="diagnostic-label">${label}</div>
                            <div class="diagnostic-value">
                                <div class="diagnostic-icon ${icon}"></div>
                                <span>${data.message}</span>
                            </div>
                        </div>
                    `;
                }).join('');
                
                content.innerHTML = diagnosticItems;
            }
            
            // ÊòæÁ§∫Ëß£ÂÜ≥ÊñπÊ°à
            showSolution(title, steps) {
                const panel = document.getElementById('solutionPanel');
                const titleEl = document.getElementById('solutionTitle');
                const stepsEl = document.getElementById('solutionSteps');
                
                if (panel && titleEl && stepsEl) {
                    titleEl.textContent = title;
                    stepsEl.innerHTML = steps.map(step => `<li>${step}</li>`).join('');
                    panel.classList.add('show');
                }
            }
            
            // ÈöêËóèËß£ÂÜ≥ÊñπÊ°à
            hideSolution() {
                const panel = document.getElementById('solutionPanel');
                if (panel) {
                    panel.classList.remove('show');
                }
            }
            
            // Ê£ÄÊµãÊµèËßàÂô®ÁéØÂ¢É
            async checkBrowser() {
                this.addLog('info', 'ÂºÄÂßãÊ£ÄÊµãÊµèËßàÂô®ÁéØÂ¢É...');
                this.updateStatus('browser', 'checking', 'Ê£ÄÊµã‰∏≠...');
                
                await this.delay(1000); // Ê®°ÊãüÊ£ÄÊµãÊó∂Èó¥
                
                const userAgent = navigator.userAgent.toLowerCase();
                let browserName = 'Unknown';
                let isSupported = false;
                
                if (userAgent.includes('chrome') && !userAgent.includes('edge')) {
                    browserName = 'Chrome';
                    isSupported = true;
                } else if (userAgent.includes('firefox')) {
                    browserName = 'Firefox';
                    isSupported = true;
                } else if (userAgent.includes('edge')) {
                    browserName = 'Edge';
                    isSupported = true;
                } else if (userAgent.includes('safari') && !userAgent.includes('chrome')) {
                    browserName = 'Safari';
                    isSupported = false;
                }
                
                if (isSupported) {
                    this.updateStatus('browser', 'success', `${browserName} ‚úÖ`);
                    this.addLog('success', `ÊµèËßàÂô®Ê£ÄÊµãÈÄöËøá: ${browserName}`);
                    return true;
                } else {
                    this.updateStatus('browser', 'error', `${browserName} ‚ùå`);
                    this.addLog('error', `‰∏çÊîØÊåÅÁöÑÊµèËßàÂô®: ${browserName}`);
                    this.showSolution('üåê ÊµèËßàÂô®ÂÖºÂÆπÊÄßÈóÆÈ¢ò', [
                        'ËØ∑‰ΩøÁî® Chrome„ÄÅFirefox Êàñ Edge ÊµèËßàÂô®',
                        'Á°Æ‰øùÊµèËßàÂô®ÁâàÊú¨ÊòØÊúÄÊñ∞ÁöÑ',
                        'Safari ÊµèËßàÂô®ÊöÇ‰∏çÊîØÊåÅ MetaMask Êâ©Â±ï',
                        'ÁßªÂä®Á´ØËØ∑‰ΩøÁî®ÂÜÖÁΩÆ DApp ÊµèËßàÂô®'
                    ]);
                    return false;
                }
            }
            
            // Ê£ÄÊµãMetaMaskÔºàÂ¢ûÂº∫ÁâàÊú¨Ôºå‰ºòÂÖàÈÄâÊã©MetaMaskÔºâ
            async checkMetaMask() {
                this.addLog('info', 'ÂºÄÂßãÂ¢ûÂº∫MetaMaskÊ£ÄÊµã...');
                this.updateStatus('metamask', 'checking', 'Ê£ÄÊµã‰∏≠...');
                
                await this.delay(800);
                
                // È¶ñÂÖàÂ∞ùËØïÂº∫Âà∂‰ΩøÁî®MetaMask
                const metamaskProvider = await this.forceSelectMetaMask();
                
                if (metamaskProvider) {
                    this.addLog('success', '‚úÖ ÊàêÂäüÈÄâÊã©MetaMask‰Ωú‰∏∫‰∏ªprovider');
                    // ‰∏¥Êó∂ÊõøÊç¢window.ethereumÁ°Æ‰øù‰ΩøÁî®MetaMask
                    window.ethereum = metamaskProvider;
                } else {
                    this.addLog('warning', '‚ö†Ô∏è Êú™ÊâæÂà∞MetaMaskÔºå‰ΩøÁî®ÈªòËÆ§Ê£ÄÊµã');
                }
                
                // ‰ΩøÁî®Â¢ûÂº∫Ê£ÄÊµãÁ≥ªÁªü
                const detectionResult = await this.enhancedWalletDetection();
                
                if (!detectionResult.metamask.detected) {
                    this.updateStatus('metamask', 'error', 'Êú™ÂÆâË£Ö ‚ùå');
                    this.addLog('error', 'MetaMask Êú™ÂÆâË£Ö');
                    this.showSolution('ü¶ä MetaMask Êú™ÂÆâË£Ö', [
                        'ËÆøÈóÆ https://metamask.io ‰∏ãËΩΩ MetaMask',
                        'ÂÆâË£ÖÊµèËßàÂô®Êâ©Â±ïÁ®ãÂ∫è',
                        'ÈáçÂêØÊµèËßàÂô®ÂêéÂà∑Êñ∞Ê≠§È°µÈù¢',
                        'Á°Æ‰øùÊâ©Â±ïÁ®ãÂ∫èÂ∑≤ÂêØÁî®'
                    ]);
                    return false;
                }
                
                // Ê£ÄÊµãÂ§öÈí±ÂåÖÂÜ≤Á™ÅÂπ∂Êèê‰æõËØ¶ÁªÜ‰ø°ÊÅØ
                if (detectionResult.web3.details.total > 1) {
                    this.addLog('warning', `Ê£ÄÊµãÂà∞${detectionResult.web3.details.total}‰∏™Èí±ÂåÖ: ${detectionResult.web3.details.providers.join(', ')}`);
                    
                    // Ê£ÄÊü•ÊòØÂê¶ÊúâÂÜ≤Á™Å
                    if (detectionResult.metamask.details.conflicts && detectionResult.metamask.details.conflicts.length > 0) {
                        this.addLog('warning', `ÂèëÁé∞Èí±ÂåÖÂÜ≤Á™Å: ${detectionResult.metamask.details.conflicts.join(', ')}`);
                        this.showSolution('‚ö†Ô∏è Â§öÈí±ÂåÖÂÜ≤Á™Å', [
                            'Âª∫ËÆÆÁ¶ÅÁî®ÂÖ∂‰ªñÈí±ÂåÖÊâ©Â±ï‰ª•ÈÅøÂÖçÂÜ≤Á™Å',
                            '‰øùÊåÅ MetaMask ÂêØÁî®',
                            'ÈáçÂêØÊµèËßàÂô®ÂêéÈáçËØï',
                            'Â¶ÇÊûúÈóÆÈ¢òÊåÅÁª≠ÔºåÂ∞ùËØï‰ΩøÁî®Êó†ÁóïÊ®°Âºè'
                        ]);
                    }
                }
                
                // Á≠âÂæÖ MetaMask ÂÆåÂÖ®Âä†ËΩΩ
                let attempts = 0;
                while (typeof window.ethereum?.request !== 'function' && attempts < 10) {
                    await this.delay(500);
                    attempts++;
                    this.addLog('info', `Á≠âÂæÖ MetaMask ÂàùÂßãÂåñ... (${attempts}/10)`);
                }
                
                if (typeof window.ethereum?.request !== 'function') {
                    this.updateStatus('metamask', 'error', 'Âä†ËΩΩÂ§±Ë¥• ‚ùå');
                    this.addLog('error', 'MetaMask ÂàùÂßãÂåñÂ§±Ë¥•');
                    this.showSolution('üîÑ MetaMask Âä†ËΩΩÈóÆÈ¢ò', [
                        'Á¶ÅÁî®ÂÖ∂‰ªñÈí±ÂåÖÊâ©Â±ïÁ®ãÂ∫è',
                        'Âà∑Êñ∞È°µÈù¢ÈáçËØï',
                        'ÈáçÂêØÊµèËßàÂô®',
                        'Ê£ÄÊü• MetaMask Êâ©Â±ïÊòØÂê¶Ê≠£Â∏∏Â∑•‰Ωú'
                    ]);
                    return false;
                }
                
                // ËÆ∞ÂΩïÊ£ÄÊµãËØ¶ÊÉÖ
                const details = detectionResult.metamask.details;
                this.addLog('info', `MetaMaskÁâàÊú¨: ${details.version}`);
                this.addLog('info', `Â∞±Áª™Áä∂ÊÄÅ: ${details.ready ? 'ÊòØ' : 'Âê¶'}`);
                
                this.updateStatus('metamask', 'success', `Â∑≤ÂÆâË£Ö ‚úÖ v${details.version}`);
                this.addLog('success', 'MetaMask Â¢ûÂº∫Ê£ÄÊµãÈÄöËøá');
                return true;
            }
            
            // Â¢ûÂº∫Èí±ÂåÖÊ£ÄÊµãÁ≥ªÁªü
            async enhancedWalletDetection() {
                const results = {
                    browser: { detected: false, details: {} },
                    metamask: { detected: false, details: {} },
                    phantom: { detected: false, details: {} },
                    coinbase: { detected: false, details: {} },
                    okx: { detected: false, details: {} },
                    web3: { detected: false, details: {} }
                };
                
                // ÊµèËßàÂô®Ê£ÄÊµã
                await this.detectBrowserEnhanced(results);
                
                // Á≠âÂæÖÈ°µÈù¢ÂÆåÂÖ®Âä†ËΩΩ
                await this.delay(1000);
                
                // MetaMask Ê£ÄÊµã
                await this.detectMetaMaskEnhanced(results);
                
                // Phantom Ê£ÄÊµã
                await this.detectPhantomEnhanced(results);
                
                // Coinbase Ê£ÄÊµã
                await this.detectCoinbaseEnhanced(results);
                
                // OKX Ê£ÄÊµã
                await this.detectOKXEnhanced(results);
                
                // ÈÄöÁî® Web3 Ê£ÄÊµã
                await this.detectWeb3Enhanced(results);
                
                return results;
            }
            
            async detectBrowserEnhanced(results) {
                const userAgent = navigator.userAgent.toLowerCase();
                let browserInfo = {
                    name: 'Unknown',
                    version: 'Unknown',
                    compatible: false,
                    engine: 'Unknown',
                    mobile: /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent)
                };
                
                // Chrome Ê£ÄÊµã
                if (userAgent.includes('chrome') && !userAgent.includes('edge') && !userAgent.includes('opr')) {
                    browserInfo.name = 'Chrome';
                    browserInfo.compatible = true;
                    browserInfo.engine = 'Chromium';
                    const match = userAgent.match(/chrome\/([0-9\.]+)/);
                    if (match) browserInfo.version = match[1];
                }
                // Edge Ê£ÄÊµã
                else if (userAgent.includes('edge')) {
                    browserInfo.name = 'Edge';
                    browserInfo.compatible = true;
                    browserInfo.engine = 'Chromium';
                    const match = userAgent.match(/edge\/([0-9\.]+)/);
                    if (match) browserInfo.version = match[1];
                }
                // Firefox Ê£ÄÊµã
                else if (userAgent.includes('firefox')) {
                    browserInfo.name = 'Firefox';
                    browserInfo.compatible = true;
                    browserInfo.engine = 'Gecko';
                    const match = userAgent.match(/firefox\/([0-9\.]+)/);
                    if (match) browserInfo.version = match[1];
                }
                // Safari Ê£ÄÊµã
                else if (userAgent.includes('safari') && !userAgent.includes('chrome')) {
                    browserInfo.name = 'Safari';
                    browserInfo.compatible = false;
                    browserInfo.engine = 'WebKit';
                    const match = userAgent.match(/version\/([0-9\.]+)/);
                    if (match) browserInfo.version = match[1];
                }
                // Opera Ê£ÄÊµã
                else if (userAgent.includes('opr') || userAgent.includes('opera')) {
                    browserInfo.name = 'Opera';
                    browserInfo.compatible = true;
                    browserInfo.engine = 'Chromium';
                }
                
                results.browser = {
                    detected: true,
                    details: browserInfo
                };
            }
            
            async detectMetaMaskEnhanced(results) {
                const details = {
                    installed: false,
                    version: 'Unknown',
                    provider: null,
                    conflicts: [],
                    ready: false
                };
                
                // Âü∫Á°ÄÊ£ÄÊµã
                if (typeof window.ethereum !== 'undefined') {
                    // Ê£ÄÊµãÊòØÂê¶‰∏∫ MetaMask
                    if (window.ethereum.isMetaMask) {
                        details.installed = true;
                        details.provider = window.ethereum;
                        details.ready = typeof window.ethereum.request === 'function';
                        
                        // ÁâàÊú¨Ê£ÄÊµã
                        try {
                            if (window.ethereum._metamask && window.ethereum._metamask.version) {
                                details.version = window.ethereum._metamask.version;
                            }
                        } catch (e) {
                            console.log('Êó†Ê≥ïËé∑ÂèñMetaMaskÁâàÊú¨');
                        }
                        
                        // Â§öÈí±ÂåÖÂÜ≤Á™ÅÊ£ÄÊµã
                        if (window.ethereum.providers && window.ethereum.providers.length > 1) {
                            details.conflicts = window.ethereum.providers
                                .filter(p => !p.isMetaMask)
                                .map(p => this.getProviderName(p));
                        }
                    }
                    // Ê£ÄÊµãÊòØÂê¶Âú® MetaMask ÂÜÖÁΩÆÊµèËßàÂô®‰∏≠
                    else if (window.ethereum.isMetaMask === undefined && window.web3) {
                        details.installed = true;
                        details.provider = window.ethereum;
                        details.ready = true;
                        details.version = 'ÂÜÖÁΩÆÊµèËßàÂô®';
                    }
                }
                
                // È¢ùÂ§ñÁöÑ MetaMask Ê£ÄÊµãÊñπÊ≥ï
                if (!details.installed) {
                    // Ê£ÄÊµãÊâ©Â±ïÊ≥®ÂÖ•
                    if (window.web3 && window.web3.currentProvider && window.web3.currentProvider.isMetaMask) {
                        details.installed = true;
                        details.provider = window.web3.currentProvider;
                        details.version = 'Legacy Web3';
                    }
                }
                
                results.metamask = {
                    detected: details.installed,
                    details
                };
            }
            
            async detectPhantomEnhanced(results) {
                const details = {
                    installed: false,
                    version: 'Unknown',
                    provider: null,
                    ethereum: false,
                    solana: false
                };
                
                // Phantom ÁâπÂÆöÊ£ÄÊµã
                if (typeof window.phantom !== 'undefined') {
                    details.installed = true;
                    
                    if (window.phantom.ethereum) {
                        details.ethereum = true;
                        details.provider = window.phantom.ethereum;
                    }
                    
                    if (window.phantom.solana) {
                        details.solana = true;
                    }
                }
                
                // ÈÄöËøá ethereum provider Ê£ÄÊµã
                if (!details.installed && typeof window.ethereum !== 'undefined') {
                    if (window.ethereum.isPhantom) {
                        details.installed = true;
                        details.ethereum = true;
                        details.provider = window.ethereum;
                    }
                }
                
                results.phantom = {
                    detected: details.installed,
                    details
                };
            }
            
            async detectCoinbaseEnhanced(results) {
                const details = {
                    installed: false,
                    version: 'Unknown',
                    provider: null,
                    mobile: false
                };
                
                // Coinbase Wallet Ê£ÄÊµã
                if (typeof window.ethereum !== 'undefined') {
                    if (window.ethereum.isCoinbaseWallet || window.ethereum.selectedProvider?.isCoinbaseWallet) {
                        details.installed = true;
                        details.provider = window.ethereum;
                    }
                }
                
                // ÁßªÂä®Á´Ø Coinbase Ê£ÄÊµã
                if (typeof window.coinbaseWalletExtension !== 'undefined') {
                    details.installed = true;
                    details.mobile = true;
                }
                
                results.coinbase = {
                    detected: details.installed,
                    details
                };
            }
            
            async detectOKXEnhanced(results) {
                const details = {
                    installed: false,
                    version: 'Unknown',
                    provider: null
                };
                
                // OKX Wallet Ê£ÄÊµã
                if (typeof window.okxwallet !== 'undefined') {
                    details.installed = true;
                    details.provider = window.okxwallet;
                }
                
                // ÈÄöËøá ethereum provider Ê£ÄÊµã
                if (!details.installed && typeof window.ethereum !== 'undefined') {
                    if (window.ethereum.isOkxWallet || window.ethereum.isOKExWallet) {
                        details.installed = true;
                        details.provider = window.ethereum;
                    }
                }
                
                results.okx = {
                    detected: details.installed,
                    details
                };
            }
            
            async detectWeb3Enhanced(results) {
                const details = {
                    ethereum: typeof window.ethereum !== 'undefined',
                    web3: typeof window.web3 !== 'undefined',
                    providers: [],
                    total: 0
                };
                
                // ÁªüËÆ°ÊâÄÊúâÊèê‰æõËÄÖ
                if (window.ethereum) {
                    if (window.ethereum.providers) {
                        details.providers = window.ethereum.providers.map(p => this.getProviderName(p));
                        details.total = window.ethereum.providers.length;
                    } else {
                        details.providers.push(this.getProviderName(window.ethereum));
                        details.total = 1;
                    }
                }
                
                results.web3 = {
                    detected: details.ethereum || details.web3,
                    details
                };
            }
            
            getProviderName(provider) {
                if (provider.isMetaMask) return 'MetaMask';
                if (provider.isPhantom) return 'Phantom';
                if (provider.isCoinbaseWallet) return 'Coinbase';
                if (provider.isOkxWallet || provider.isOKExWallet) return 'OKX';
                if (provider.isBraveWallet) return 'Brave';
                return 'Unknown Provider';
            }
            
            // Âº∫Âà∂ÈÄâÊã©MetaMask‰Ωú‰∏∫‰∏ªprovider
            async forceSelectMetaMask() {
                this.addLog('info', 'üîç ÊêúÁ¥¢MetaMask provider...');
                
                if (typeof window.ethereum === 'undefined') {
                    this.addLog('error', '‚ùå window.ethereum‰∏çÂ≠òÂú®');
                    return null;
                }
                
                // Ê£ÄÊü•ÂΩìÂâçwindow.ethereumÊòØÂê¶Â∑≤ÁªèÊòØMetaMask
                if (window.ethereum.isMetaMask && !window.ethereum.isPhantom) {
                    this.addLog('success', '‚úÖ window.ethereumÂ∑≤ÁªèÊòØMetaMask');
                    return window.ethereum;
                }
                
                // Ê£ÄÊü•Â§öproviderÁéØÂ¢É
                if (window.ethereum.providers && Array.isArray(window.ethereum.providers)) {
                    this.addLog('info', `üîç Ê£ÄÊü•${window.ethereum.providers.length}‰∏™provider...`);
                    
                    for (let i = 0; i < window.ethereum.providers.length; i++) {
                        const provider = window.ethereum.providers[i];
                        const providerName = this.getProviderName(provider);
                        this.addLog('info', `  Provider ${i+1}: ${providerName}`);
                        
                        if (provider.isMetaMask && !provider.isPhantom) {
                            this.addLog('success', `‚úÖ ÊâæÂà∞MetaMask provider (‰ΩçÁΩÆ: ${i+1})`);
                            return provider;
                        }
                    }
                    
                    this.addLog('warning', '‚ö†Ô∏è Âú®Â§öproviderÁéØÂ¢É‰∏≠Êú™ÊâæÂà∞Á∫ØMetaMask');
                } else {
                    // ÂçïproviderÁéØÂ¢É
                    if (window.ethereum.isPhantom && !window.ethereum.isMetaMask) {
                        this.addLog('warning', '‚ö†Ô∏è window.ethereumË¢´PhantomÊéßÂà∂');
                        
                        // Â∞ùËØïÊü•ÊâæÂéüÂßãÁöÑMetaMask
                        if (window.ethereum._metamask) {
                            this.addLog('info', 'üîç Â∞ùËØïËÆøÈóÆÂéüÂßãMetaMask...');
                            return window.ethereum._metamask;
                        }
                    }
                }
                
                // ÊúÄÂêéÁöÑÂ∞ùËØïÔºöÊ£ÄÊü•ÊòØÂê¶Êúâ‰øùÂ≠òÁöÑÂÅèÂ•ΩËÆæÁΩÆ
                const preferredWallet = localStorage.getItem('preferredWallet');
                if (preferredWallet === 'metamask') {
                    this.addLog('info', 'üíæ Ê£ÄÊµãÂà∞MetaMaskÂÅèÂ•ΩËÆæÁΩÆ');
                    // Âç≥‰ΩøÂèØËÉΩ‰∏çÂÆåÁæéÔºå‰πü‰ºòÂÖà‰ΩøÁî®window.ethereum
                    return window.ethereum;
                }
                
                this.addLog('warning', '‚ö†Ô∏è Êú™ÊâæÂà∞ÁêÜÊÉ≥ÁöÑMetaMask providerÔºå‰ΩøÁî®ÈªòËÆ§');
                return null;
            }
            
            // Á¶ÅÁî®ÂÖ∂‰ªñÈí±ÂåÖÁöÑËá™Âä®ËøûÊé•
            disableOtherWallets() {
                this.addLog('info', 'üîá Á¶ÅÁî®ÂÖ∂‰ªñÈí±ÂåÖÁöÑËá™Âä®Ë°å‰∏∫...');
                
                try {
                    // Á¶ÅÁî®PhantomËá™Âä®ËøûÊé•
                    if (window.phantom) {
                        if (typeof window.phantom.connect === 'function') {
                            const originalConnect = window.phantom.connect;
                            window.phantom.connect = function() {
                                console.log('Phantom connect blocked by FMH system');
                                return Promise.resolve([]);
                            };
                            this.addLog('success', '‚úÖ Â∑≤ÈòªÊ≠¢PhantomËá™Âä®ËøûÊé•');
                        }
                    }
                    
                    // Á¶ÅÁî®ÂÖ∂‰ªñÂèØËÉΩÁöÑËá™Âä®ËøûÊé•
                    if (window.ethereum && window.ethereum.isPhantom) {
                        // Â¶ÇÊûúwindow.ethereumË¢´PhantomÊéßÂà∂ÔºåÂ∞ùËØïÈòªÊ≠¢Ëá™Âä®Ë°å‰∏∫
                        if (window.ethereum.isConnected && window.ethereum.isConnected()) {
                            this.addLog('warning', '‚ö†Ô∏è PhantomÂ∑≤ËøûÊé•ÔºåÂ∞ùËØï‰ΩøÁî®MetaMask‰ºòÂÖà');
                        }
                    }
                    
                } catch (error) {
                    this.addLog('warning', `‚ö†Ô∏è Á¶ÅÁî®ÂÖ∂‰ªñÈí±ÂåÖÊó∂Âá∫Èîô: ${error.message}`);
                }
            }
            
            // Ê£ÄÊµãÁΩëÁªúËøûÊé•
            async checkNetwork() {
                this.addLog('info', 'ÂºÄÂßãÊ£ÄÊµãÁΩëÁªúËøûÊé•...');
                this.updateStatus('network', 'checking', 'ËøûÊé•‰∏≠...');
                
                try {
                    // ËØ∑Ê±ÇËøûÊé•Ë¥¶Êà∑
                    this.addLog('info', 'ËØ∑Ê±ÇËøûÊé• MetaMask Ë¥¶Êà∑...');
                    const accounts = await window.ethereum.request({ 
                        method: 'eth_requestAccounts' 
                    });
                    
                    if (accounts.length === 0) {
                        throw new Error('Ê≤°ÊúâÂèØÁî®Ë¥¶Êà∑');
                    }
                    
                    this.addLog('success', `Ë¥¶Êà∑ËøûÊé•ÊàêÂäü: ${accounts[0]}`);
                    
                    // Ê£ÄÊü•ÂΩìÂâçÁΩëÁªúÔºàÂ¢ûÂº∫Ë∞ÉËØïÔºâ
                    const chainId = await window.ethereum.request({ 
                        method: 'eth_chainId' 
                    });
                    
                    const chainIdDecimal = parseInt(chainId, 16);
                    this.addLog('info', `ÂΩìÂâçÁΩëÁªú Chain ID: ${chainId} (ÂçÅËøõÂà∂: ${chainIdDecimal})`);
                    
                    const targetChainId = '0x279F'; // Monad Testnet
                    const targetChainIdDecimal = 10143;
                    
                    // ËØ¶ÁªÜÁöÑÁΩëÁªúÂåπÈÖçÊ£ÄÊü• (ÊîØÊåÅÂ§ßÂ∞èÂÜôÂøΩÁï•)
                    this.addLog('info', `ÁõÆÊ†áÁΩëÁªú: ${targetChainId} (ÂçÅËøõÂà∂: ${targetChainIdDecimal})`);
                    
                    const chainIdMatch = {
                        exact: chainId === targetChainId,
                        caseInsensitive: chainId.toLowerCase() === targetChainId.toLowerCase(),
                        decimal: parseInt(chainId, 16) === targetChainIdDecimal
                    };
                    
                    this.addLog('info', `‰∏•Ê†ºÂåπÈÖç: ${chainIdMatch.exact ? '‚úÖ' : '‚ùå'}`);
                    this.addLog('info', `ÂøΩÁï•Â§ßÂ∞èÂÜô: ${chainIdMatch.caseInsensitive ? '‚úÖ' : '‚ùå'}`);
                    this.addLog('info', `ÂçÅËøõÂà∂ÂåπÈÖç: ${chainIdMatch.decimal ? '‚úÖ' : '‚ùå'}`);
                    
                    // ‰ΩøÁî®Êõ¥ÂÆΩÊùæÁöÑÂåπÈÖçÊù°‰ª∂
                    const networkMatched = chainIdMatch.caseInsensitive || chainIdMatch.decimal;
                    
                    if (!networkMatched) {
                        this.addLog('warning', `ÈúÄË¶ÅÂàáÊç¢Âà∞ Monad ÊµãËØïÁΩëÁªú...`);
                        this.addLog('warning', `ÂΩìÂâç: ${chainId} (${chainIdDecimal}), ÁõÆÊ†á: ${targetChainId} (${targetChainIdDecimal})`);
                        
                        try {
                            this.addLog('info', 'Â∞ùËØïÂàáÊç¢ÁΩëÁªú...');
                            await window.ethereum.request({
                                method: 'wallet_switchEthereumChain',
                                params: [{ chainId: targetChainId }],
                            });
                            this.addLog('success', 'ÁΩëÁªúÂàáÊç¢ÊàêÂäü');
                        } catch (switchError) {
                            this.addLog('warning', `ÂàáÊç¢Â§±Ë¥•: ${switchError.message} (‰ª£Á†Å: ${switchError.code})`);
                            
                            if (switchError.code === 4902) {
                                this.addLog('info', 'ÁΩëÁªú‰∏çÂ≠òÂú®ÔºåÊ≠£Âú®Ê∑ªÂä† Monad ÊµãËØïÁΩëÁªú...');
                                try {
                                    await window.ethereum.request({
                                        method: 'wallet_addEthereumChain',
                                        params: [{
                                            chainId: targetChainId,
                                            chainName: 'Monad Testnet',
                                            nativeCurrency: {
                                                name: 'MON',
                                                symbol: 'MON',
                                                decimals: 18
                                            },
                                            rpcUrls: [
                                                'https://testnet-rpc.monad.xyz',
                                                'https://monad-testnet-rpc.publicnode.com'
                                            ],
                                            blockExplorerUrls: ['https://testnet-explorer.monad.xyz']
                                        }]
                                    });
                                    this.addLog('success', 'Monad ÊµãËØïÁΩëÊ∑ªÂä†ÊàêÂäü');
                                    
                                    // Ê∑ªÂä†ÂêéÂÜçÊ¨°Â∞ùËØïÂàáÊç¢
                                    this.addLog('info', 'ÂÜçÊ¨°Â∞ùËØïÂàáÊç¢ÁΩëÁªú...');
                                    await window.ethereum.request({
                                        method: 'wallet_switchEthereumChain',
                                        params: [{ chainId: targetChainId }],
                                    });
                                    this.addLog('success', 'ÁΩëÁªúÂàáÊç¢ÊàêÂäü');
                                } catch (addError) {
                                    this.addLog('error', `Ê∑ªÂä†ÁΩëÁªúÂ§±Ë¥•: ${addError.message}`);
                                    throw addError;
                                }
                            } else if (switchError.code === 4001) {
                                throw new Error('Áî®Êà∑ÊãíÁªùÂàáÊç¢ÁΩëÁªú');
                            } else {
                                throw switchError;
                            }
                        }
                    } else {
                        this.addLog('success', '‚úÖ Â∑≤Âú®Ê≠£Á°ÆÁöÑÁΩëÁªú‰∏ä (Monad Testnet)');
                    }
                    
                    // ÊúÄÁªàÈ™åËØÅ (‰ΩøÁî®ÂÆΩÊùæÂåπÈÖç)
                    const finalChainId = await window.ethereum.request({ method: 'eth_chainId' });
                    const finalMatch = finalChainId.toLowerCase() === targetChainId.toLowerCase() || 
                                      parseInt(finalChainId, 16) === targetChainIdDecimal;
                    
                    if (finalMatch) {
                        this.addLog('success', `ÊúÄÁªàÈ™åËØÅÈÄöËøá: ${finalChainId} (${parseInt(finalChainId, 16)})`);
                        if (finalChainId !== targetChainId) {
                            this.addLog('info', `Ê≥®ÊÑè: Chain IDÂ§ßÂ∞èÂÜô‰∏çÂêå‰ΩÜÊï∞ÂÄºÂåπÈÖç`);
                        }
                    } else {
                        this.addLog('error', `ÊúÄÁªàÈ™åËØÅÂ§±Ë¥•: ${finalChainId} != ${targetChainId}`);
                        throw new Error(`ÁΩëÁªúÈ™åËØÅÂ§±Ë¥•: ÂΩìÂâç ${finalChainId}, ÈúÄË¶Å ${targetChainId}`);
                    }
                    
                    // ÂàõÂª∫ provider
                    this.provider = new ethers.providers.Web3Provider(window.ethereum);
                    this.signer = this.provider.getSigner();
                    
                    // ÊµãËØïÁΩëÁªúËøûÈÄöÊÄß
                    this.addLog('info', 'ÊµãËØïÁΩëÁªúËøûÈÄöÊÄß...');
                    const balance = await this.signer.getBalance();
                    this.addLog('info', `Ë¥¶Êà∑‰ΩôÈ¢ù: ${ethers.utils.formatEther(balance)} MON`);
                    
                    this.updateStatus('network', 'success', 'Monad ÊµãËØïÁΩë ‚úÖ');
                    this.addLog('success', 'ÁΩëÁªúËøûÊé•Ê£ÄÊµãÈÄöËøá');
                    return true;
                    
                } catch (error) {
                    this.updateStatus('network', 'error', 'ËøûÊé•Â§±Ë¥• ‚ùå');
                    this.addLog('error', `ÁΩëÁªúËøûÊé•Â§±Ë¥•: ${error.message}`);
                    
                    if (error.message.includes('User rejected')) {
                        this.showSolution('‚ùå Áî®Êà∑Êìç‰ΩúÈóÆÈ¢ò', [
                            'ËØ∑Âú® MetaMask ÂºπÁ™ó‰∏≠ÁÇπÂáª"ËøûÊé•"',
                            'ÂÖÅËÆ∏ÁΩëÁ´ôËÆøÈóÆÊÇ®ÁöÑÈí±ÂåÖÂú∞ÂùÄ',
                            'Á°ÆËÆ§ÁΩëÁªúÂàáÊç¢ËØ∑Ê±Ç',
                            'Â¶ÇÊûúÊ≤°ÊúâÁúãÂà∞ÂºπÁ™óÔºåËØ∑Ê£ÄÊü•ÊµèËßàÂô®ÂºπÁ™óÊã¶Êà™ËÆæÁΩÆ'
                        ]);
                    } else {
                        this.showSolution('üåê ÁΩëÁªúËøûÊé•ÈóÆÈ¢ò', [
                            'Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÊòØÂê¶Ê≠£Â∏∏',
                            'Â∞ùËØïÂà∑Êñ∞È°µÈù¢ÈáçÊñ∞ËøûÊé•',
                            'Á°Æ‰øù MetaMask Ê≤°ÊúâË¢´ÂÖ∂‰ªñÈ°µÈù¢Âç†Áî®',
                            'ÈáçÂêØ MetaMask Êâ©Â±ïÁ®ãÂ∫è'
                        ]);
                    }
                    return false;
                }
            }
            
            // Ê£ÄÊµãÂêàÁ∫¶
            async checkContract() {
                this.addLog('info', 'ÂºÄÂßãÈ™åËØÅÊô∫ËÉΩÂêàÁ∫¶...');
                this.updateStatus('contract', 'checking', 'È™åËØÅ‰∏≠...');
                
                try {
                    const userAddress = await this.signer.getAddress();
                    this.addLog('info', `Áî®Êà∑Âú∞ÂùÄ: ${userAddress}`);
                    
                    // Á°ÆÂÆöÂêàÁ∫¶Âú∞ÂùÄ
                    let contractAddress = '0xFa32A01E4FDAde90204902EDfEa63C150407C736';
                    
                    this.addLog('info', `ÂêàÁ∫¶Âú∞ÂùÄ: ${contractAddress}`);
                    
                    // Âü∫Á°ÄÂêàÁ∫¶ABI - Âè™ÂåÖÂê´ÊúÄÂü∫Êú¨ÁöÑÂáΩÊï∞
                    const basicABI = [
                        "function name() external view returns (string)",
                        "function symbol() external view returns (string)",
                        "function totalSupply() external view returns (uint256)",
                        "function balanceOf(address account) external view returns (uint256)"
                    ];
                    
                    // ÂàõÂª∫ÂêàÁ∫¶ÂÆû‰æã
                    this.contract = new ethers.Contract(contractAddress, basicABI, this.signer);
                    
                    // ÊµãËØïÂêàÁ∫¶ËøûÊé•
                    this.addLog('info', 'ÊµãËØïÂêàÁ∫¶Âü∫Á°ÄÂäüËÉΩ...');
                    const name = await this.contract.name();
                    const symbol = await this.contract.symbol();
                    const totalSupply = await this.contract.totalSupply();
                    
                    this.addLog('success', `ÂêàÁ∫¶ÂêçÁß∞: ${name}`);
                    this.addLog('success', `ÂêàÁ∫¶Á¨¶Âè∑: ${symbol}`);
                    this.addLog('success', `ÊÄª‰æõÂ∫îÈáè: ${ethers.utils.formatEther(totalSupply)}`);
                    
                    this.updateStatus('contract', 'success', `${symbol} ÂêàÁ∫¶ ‚úÖ`);
                    this.addLog('success', 'Êô∫ËÉΩÂêàÁ∫¶È™åËØÅÈÄöËøá');
                    return true;
                    
                } catch (error) {
                    this.updateStatus('contract', 'error', 'È™åËØÅÂ§±Ë¥• ‚ùå');
                    this.addLog('error', `ÂêàÁ∫¶È™åËØÅÂ§±Ë¥•: ${error.message}`);
                    
                    this.showSolution('üìÑ ÂêàÁ∫¶È™åËØÅÈóÆÈ¢ò', [
                        'Ê£ÄÊü•ÂêàÁ∫¶Âú∞ÂùÄÊòØÂê¶Ê≠£Á°Æ',
                        'Á°ÆËÆ§ÊÇ®Âú®Ê≠£Á°ÆÁöÑÁΩëÁªú‰∏äÔºàMonad ÊµãËØïÁΩëÔºâ',
                        'ÂêàÁ∫¶ÂèØËÉΩÂ∞öÊú™ÈÉ®ÁΩ≤ÊàñÈ™åËØÅ',
                        'Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÂíåRPCËäÇÁÇπÁä∂ÊÄÅ'
                    ]);
                    return false;
                }
            }
            
            // ÂºÄÂßãÊô∫ËÉΩËøûÊé•
            async startConnection() {
                this.addLog('info', '=== ÂºÄÂßãÊô∫ËÉΩÈí±ÂåÖËøûÊé• ===');
                
                // È¶ñÂÖàÁ¶ÅÁî®ÂÖ∂‰ªñÈí±ÂåÖÁöÑÂπ≤Êâ∞
                this.disableOtherWallets();
                
                // ÈáçÁΩÆÁä∂ÊÄÅ
                this.hideSolution();
                
                // ËÆæÁΩÆÊåâÈíÆÁä∂ÊÄÅ
                const btn = document.getElementById('connectBtn');
                btn.classList.add('loading');
                btn.disabled = true;
                
                try {
                    // Á≠âÂæÖ ethers.js Âä†ËΩΩ
                    await this.waitForEthers();
                    
                    // ÊâßË°åÊ£ÄÊµãÊ≠•È™§
                    const browserOk = await this.checkBrowser();
                    if (!browserOk) throw new Error('ÊµèËßàÂô®Ê£ÄÊµãÂ§±Ë¥•');
                    
                    const metamaskOk = await this.checkMetaMask();
                    if (!metamaskOk) throw new Error('MetaMask Ê£ÄÊµãÂ§±Ë¥•');
                    
                    const networkOk = await this.checkNetwork();
                    if (!networkOk) throw new Error('ÁΩëÁªúËøûÊé•Â§±Ë¥•');
                    
                    const contractOk = await this.checkContract();
                    if (!contractOk) throw new Error('ÂêàÁ∫¶È™åËØÅÂ§±Ë¥•');
                    
                    // ËøûÊé•ÊàêÂäü
                    this.addLog('success', '=== üéâ ËøûÊé•ÂÆåÂÖ®ÊàêÂäüÔºÅ ===');
                    this.hideSolution();
                    
                    // ÊòæÁ§∫ÁÆ°ÁêÜÈù¢Êùø
                    setTimeout(() => {
                        this.showManagementPanel();
                    }, 1000);
                    
                } catch (error) {
                    this.addLog('error', `ËøûÊé•Â§±Ë¥•: ${error.message}`);
                } finally {
                    // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                    btn.classList.remove('loading');
                    btn.disabled = false;
                }
            }
            
            // Á≠âÂæÖ ethers.js Âä†ËΩΩ
            async waitForEthers() {
                this.addLog('info', 'Á≠âÂæÖ‰æùËµñÂ∫ìÂä†ËΩΩ...');
                
                if (typeof ethers !== 'undefined') {
                    this.addLog('success', 'Ethers.js Â∑≤Âä†ËΩΩ');
                    return;
                }
                
                // Âä®ÊÄÅÂä†ËΩΩ ethers.js
                const script = document.createElement('script');
                script.src = 'https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js';
                
                return new Promise((resolve, reject) => {
                    script.onload = () => {
                        if (typeof ethers !== 'undefined') {
                            this.addLog('success', 'Ethers.js Âä®ÊÄÅÂä†ËΩΩÊàêÂäü');
                            resolve();
                        } else {
                            reject(new Error('Ethers.js Âä†ËΩΩÂ§±Ë¥•'));
                        }
                    };
                    script.onerror = () => reject(new Error('Ethers.js ËÑöÊú¨Âä†ËΩΩÂ§±Ë¥•'));
                    document.head.appendChild(script);
                });
            }
            
            // Â∑•ÂÖ∑ÂáΩÊï∞
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            // ÈáçÁΩÆËøûÊé•
            reset() {
                this.diagnostics = {
                    browser: { status: 'pending', message: 'Á≠âÂæÖÊ£ÄÊµã...' },
                    metamask: { status: 'pending', message: 'Á≠âÂæÖÊ£ÄÊµã...' },
                    network: { status: 'pending', message: 'Á≠âÂæÖÊ£ÄÊµã...' },
                    contract: { status: 'pending', message: 'Á≠âÂæÖÊ£ÄÊµã...' }
                };
                this.logs = [];
                
                // Êõ¥Êñ∞UI
                this.updateStatus('browser', 'pending', 'Á≠âÂæÖÊ£ÄÊµã...');
                this.updateStatus('metamask', 'pending', 'Á≠âÂæÖÊ£ÄÊµã...');
                this.updateStatus('network', 'pending', 'Á≠âÂæÖÊ£ÄÊµã...');
                this.updateStatus('contract', 'pending', 'Á≠âÂæÖÊ£ÄÊµã...');
                
                this.hideSolution();
                document.getElementById('mainPanel').classList.add('hidden');
                document.getElementById('logContent').innerHTML = '';
                
                this.addLog('info', 'ËøûÊé•Áä∂ÊÄÅÂ∑≤ÈáçÁΩÆ');
            }
            
            // ‰∏ãËΩΩËØäÊñ≠Êä•Âëä
            downloadReport() {
                const report = {
                    timestamp: new Date().toISOString(),
                    diagnostics: this.diagnostics,
                    logs: this.logs,
                    userAgent: navigator.userAgent,
                    url: window.location.href
                };
                
                const blob = new Blob([JSON.stringify(report, null, 2)], {
                    type: 'application/json'
                });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `fmh-wallet-diagnostic-${Date.now()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.addLog('success', 'ËØäÊñ≠Êä•ÂëäÂ∑≤‰∏ãËΩΩ');
            }
            
            // ÊòæÁ§∫ÁÆ°ÁêÜÈù¢Êùø
            async showManagementPanel() {
                try {
                    // ÊòæÁ§∫ÁÆ°ÁêÜÈù¢Êùø
                    document.getElementById('mainPanel').classList.remove('hidden');
                    
                    // Ëé∑ÂèñÁî®Êà∑Âú∞ÂùÄÂíåÊùÉÈôê‰ø°ÊÅØ
                    const userAddress = await this.signer.getAddress();
                    const balance = await this.signer.getBalance();
                    
                    // Êõ¥Êñ∞ËøûÊé•‰ø°ÊÅØÊòæÁ§∫
                    const walletInfo = document.getElementById('connectedWalletInfo');
                    walletInfo.innerHTML = `
                        <strong>Âú∞ÂùÄ:</strong> ${userAddress}<br>
                        <strong>‰ΩôÈ¢ù:</strong> ${parseFloat(ethers.utils.formatEther(balance)).toFixed(4)} MON<br>
                        <strong>ÁΩëÁªú:</strong> Monad ÊµãËØïÁΩë
                    `;
                    
                    // Ëá™Âä®Âà∑Êñ∞ÂêàÁ∫¶‰ø°ÊÅØ
                    await this.refreshContractInfo();
                    
                } catch (error) {
                    this.addLog('error', `ÊòæÁ§∫ÁÆ°ÁêÜÈù¢ÊùøÂ§±Ë¥•: ${error.message}`);
                }
            }
            
            // Âà∑Êñ∞ÂêàÁ∫¶‰ø°ÊÅØ
            async refreshContractInfo() {
                try {
                    this.addLog('info', 'Ê≠£Âú®Âà∑Êñ∞ÂêàÁ∫¶‰ø°ÊÅØ...');
                    
                    // ÂêàÁ∫¶ABIÂÆö‰πâ
                    const contractABI = [
                        "function name() external view returns (string)",
                        "function symbol() external view returns (string)",
                        "function decimals() external view returns (uint8)",
                        "function totalSupply() external view returns (uint256)",
                        "function balanceOf(address account) external view returns (uint256)",
                        "function mint(address to, uint256 amount) external",
                        "function burn(uint256 amount) external",
                        "function burnFrom(address from, uint256 amount) external",
                        "function batchBurn(address[] calldata accounts, uint256[] calldata amounts) external",
                        "function addAuthorizedMinter(address minter) external",
                        "function removeAuthorizedMinter(address minter) external",
                        "function isAuthorizedMinter(address minter) external view returns (bool)",
                        "function getTotalBurned() external view returns (uint256)",
                        "function getBurnRate() external view returns (uint256)",
                        "function setMinesweeperGame(address _game) external",
                        "function minesweeperGame() external view returns (address)"
                    ];
                    
                    // ‰ΩøÁî®Âõ∫ÂÆöÁöÑÂêàÁ∫¶Âú∞ÂùÄ
                    const contractAddress = '0xFa32A01E4FDAde90204902EDfEa63C150407C736';
                    this.contract = new ethers.Contract(contractAddress, contractABI, this.signer);
                    
                    // Ëé∑ÂèñÂü∫Á°Ä‰ø°ÊÅØ
                    const [name, symbol, decimals, totalSupply] = await Promise.all([
                        this.contract.name(),
                        this.contract.symbol(),
                        this.contract.decimals(),
                        this.contract.totalSupply()
                    ]);
                    
                    let infoHTML = `
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="value">${name}</div>
                                <div class="label">‰ª£Â∏ÅÂêçÁß∞</div>
                            </div>
                            <div class="info-item">
                                <div class="value">${symbol}</div>
                                <div class="label">‰ª£Â∏ÅÁ¨¶Âè∑</div>
                            </div>
                            <div class="info-item">
                                <div class="value">${decimals}</div>
                                <div class="label">Â∞èÊï∞‰ΩçÊï∞</div>
                            </div>
                            <div class="info-item">
                                <div class="value">${this.formatToken(totalSupply)}</div>
                                <div class="label">ÊÄª‰æõÂ∫îÈáè</div>
                            </div>
                    `;
                    
                    // Â∞ùËØïËé∑ÂèñÈ¢ùÂ§ñ‰ø°ÊÅØ
                    try {
                        const totalBurned = await this.contract.getTotalBurned();
                        infoHTML += `
                            <div class="info-item">
                                <div class="value">${this.formatToken(totalBurned)}</div>
                                <div class="label">Â∑≤ÈîÄÊØÅÊï∞Èáè</div>
                            </div>
                        `;
                    } catch (e) {
                        console.log('getTotalBurned ‰∏çÂèØÁî®');
                    }
                    
                    try {
                        const burnRate = await this.contract.getBurnRate();
                        infoHTML += `
                            <div class="info-item">
                                <div class="value">${(burnRate / 100).toFixed(2)}%</div>
                                <div class="label">ÈîÄÊØÅÁéá</div>
                            </div>
                        `;
                    } catch (e) {
                        console.log('getBurnRate ‰∏çÂèØÁî®');
                    }
                    
                    infoHTML += `</div>`;
                    document.getElementById('contractInfo').innerHTML = infoHTML;
                    
                    this.addLog('success', 'ÂêàÁ∫¶‰ø°ÊÅØÂà∑Êñ∞ÂÆåÊàê');
                    
                } catch (error) {
                    console.error('Âà∑Êñ∞ÂêàÁ∫¶‰ø°ÊÅØÂ§±Ë¥•:', error);
                    document.getElementById('contractInfo').innerHTML = 
                        `<div class="status error">‚ùå Âà∑Êñ∞Â§±Ë¥•: ${error.message}</div>`;
                    this.addLog('error', `Âà∑Êñ∞ÂêàÁ∫¶‰ø°ÊÅØÂ§±Ë¥•: ${error.message}`);
                }
            }
            
            // Ê†ºÂºèÂåñ‰ª£Â∏ÅÊï∞Èáè
            formatToken(amount) {
                try {
                    return parseFloat(ethers.utils.formatEther(amount)).toLocaleString('zh-CN', {
                        minimumFractionDigits: 0,
                        maximumFractionDigits: 6
                    });
                } catch {
                    return '0';
                }
            }
        }
        
        // ÂàõÂª∫ÂÖ®Â±ÄËøûÊé•Âô®ÂÆû‰æã
        const connector = new SmartWalletConnector();
        
        // È°µÈù¢‰∫§‰∫íÂáΩÊï∞
        function startSmartConnection() {
            connector.startConnection();
        }
        
        function resetConnection() {
            connector.reset();
        }
        
        function toggleDiagnostics() {
            const panel = document.getElementById('diagnosticPanel');
            panel.classList.toggle('show');
        }
        
        function toggleLogs() {
            const panel = document.getElementById('logPanel');
            panel.classList.toggle('show');
        }
        
        function downloadReport() {
            connector.downloadReport();
        }
        
        // Âº∫Âà∂‰ΩøÁî®MetaMask - Á´ãÂç≥ÊâßË°åÁâàÊú¨
        async function forceUseMetaMaskNow() {
            try {
                connector.addLog('info', 'ü¶ä Áî®Êà∑Ëß¶ÂèëÂº∫Âà∂MetaMaskÊ®°Âºè...');
                
                const metamaskProvider = await connector.forceSelectMetaMask();
                if (metamaskProvider) {
                    // ‰∏¥Êó∂Ë¶ÜÁõñwindow.ethereum
                    window.ethereum = metamaskProvider;
                    
                    // ‰øùÂ≠òÁî®Êà∑ÂÅèÂ•Ω
                    localStorage.setItem('preferredWallet', 'metamask');
                    
                    // Á¶ÅÁî®ÂÖ∂‰ªñÈí±ÂåÖ
                    connector.disableOtherWallets();
                    
                    connector.addLog('success', '‚úÖ Â∑≤Âº∫Âà∂ÂàáÊç¢Âà∞MetaMaskÔºÅ');
                    alert('‚úÖ Â∑≤Âº∫Âà∂ÂàáÊç¢Âà∞MetaMaskÔºÅ\nËØ∑ÁÇπÂáª"Êô∫ËÉΩËøûÊé•Èí±ÂåÖ"ÈáçÊñ∞ËøûÊé•„ÄÇ');
                    
                    // ÈáçÁΩÆËøûÊé•Áä∂ÊÄÅÔºåËÆ©Áî®Êà∑ÈáçÊñ∞ËøûÊé•
                    connector.reset();
                } else {
                    connector.addLog('error', '‚ùå Êú™ÊâæÂà∞MetaMask provider');
                    alert('‚ùå Êú™ÊâæÂà∞MetaMaskÔºåËØ∑Á°Æ‰øùÂ∑≤ÂÆâË£ÖÂπ∂ÂêØÁî®MetaMaskÊâ©Â±ï„ÄÇ');
                }
            } catch (error) {
                connector.addLog('error', `Âº∫Âà∂‰ΩøÁî®MetaMaskÂ§±Ë¥•: ${error.message}`);
                alert('‚ùå Êìç‰ΩúÂ§±Ë¥•: ' + error.message);
            }
        }
        
        // ÊòæÁ§∫Èí±ÂåÖÊ£ÄÊµãÊä•Âëä
        async function showWalletDetectionReport() {
            const panel = document.getElementById('walletDetectionPanel');
            const content = document.getElementById('walletDetectionContent');
            
            if (panel.classList.contains('show')) {
                panel.classList.remove('show');
                return;
            }
            
            content.innerHTML = '<div class="diagnostic-item"><div class="diagnostic-label">Ê≠£Âú®Ê£ÄÊµãÈí±ÂåÖÁéØÂ¢É...</div></div>';
            panel.classList.add('show');
            
            try {
                const detectionResult = await connector.enhancedWalletDetection();
                generateWalletDetectionReport(content, detectionResult);
            } catch (error) {
                content.innerHTML = '<div class="diagnostic-item"><div class="diagnostic-label" style="color: #ef4444;">Ê£ÄÊµãÂ§±Ë¥•: ' + error.message + '</div></div>';
            }
        }
        
        // ÁîüÊàêÈí±ÂåÖÊ£ÄÊµãÊä•Âëä
        function generateWalletDetectionReport(content, results) {
            const wallets = [
                { key: 'metamask', name: 'MetaMask', icon: 'ü¶ä' },
                { key: 'phantom', name: 'Phantom', icon: 'üëª' },
                { key: 'coinbase', name: 'Coinbase Wallet', icon: 'üî∑' },
                { key: 'okx', name: 'OKX Wallet', icon: '‚ö´' }
            ];
            
            let reportHTML = `
                <!-- ÊµèËßàÂô®ÁéØÂ¢É -->
                <div class="diagnostic-item">
                    <div class="diagnostic-label">üåê ÊµèËßàÂô®ÁéØÂ¢É</div>
                    <div class="diagnostic-value">
                        <span style="color: ${results.browser.details.compatible ? '#10b981' : '#f59e0b'};">
                            ${results.browser.details.name} ${results.browser.details.version} 
                            (${results.browser.details.engine})
                            ${results.browser.details.mobile ? ' üì±' : ''}
                            ${results.browser.details.compatible ? ' ‚úÖ' : ' ‚ö†Ô∏è'}
                        </span>
                    </div>
                </div>
                
                <!-- Web3 ÁéØÂ¢É -->
                <div class="diagnostic-item">
                    <div class="diagnostic-label">üåê Web3 ÁéØÂ¢É</div>
                    <div class="diagnostic-value">
                        <span style="color: ${results.web3.detected ? '#10b981' : '#ef4444'};">
                            ${results.web3.detected ? 'Â∑≤Â∞±Áª™' : 'Êú™Â∞±Áª™'} 
                            ${results.web3.detected ? '‚úÖ' : '‚ùå'}
                            <br><small>Ê£ÄÊµãÂà∞ ${results.web3.details.total} ‰∏™Êèê‰æõËÄÖ: ${results.web3.details.providers.join(', ')}</small>
                        </span>
                    </div>
                </div>
                
                <hr style="margin: 20px 0; border: 1px solid #e5e7eb;">
                
                <!-- Èí±ÂåÖËØ¶ÊÉÖ -->
            `;
            
            wallets.forEach(wallet => {
                const result = results[wallet.key];
                const details = result.details;
                
                reportHTML += `
                    <div class="diagnostic-item">
                        <div class="diagnostic-label">${wallet.icon} ${wallet.name}</div>
                        <div class="diagnostic-value">
                            <div style="color: ${result.detected ? '#10b981' : '#ef4444'};">
                                ${result.detected ? 'Â∑≤ÂÆâË£Ö ‚úÖ' : 'Êú™ÂÆâË£Ö ‚ùå'}
                            </div>
                `;
                
                if (result.detected) {
                    reportHTML += `<div style="font-size: 0.85em; margin-top: 4px; color: #6b7280;">`;
                    
                    if (details.version && details.version !== 'Unknown') {
                        reportHTML += `ÁâàÊú¨: ${details.version}<br>`;
                    }
                    
                    if (details.ready !== undefined) {
                        reportHTML += `Â∞±Áª™Áä∂ÊÄÅ: ${details.ready ? 'ÊòØ' : 'Âê¶'}<br>`;
                    }
                    
                    if (details.conflicts && details.conflicts.length > 0) {
                        reportHTML += `<span style="color: #f59e0b;">‚ö†Ô∏è ÂÜ≤Á™Å: ${details.conflicts.join(', ')}</span><br>`;
                    }
                    
                    if (details.ethereum) {
                        reportHTML += `üîó ÊîØÊåÅ‰ª•Â§™Âùä<br>`;
                    }
                    
                    if (details.solana) {
                        reportHTML += `üîó ÊîØÊåÅSolana<br>`;
                    }
                    
                    if (details.mobile) {
                        reportHTML += `üì± ÁßªÂä®Á´ØÁâàÊú¨<br>`;
                    }
                    
                    reportHTML += `</div>`;
                }
                
                reportHTML += `
                        </div>
                    </div>
                `;
            });
            
            // Êô∫ËÉΩÊé®Ëçê
            const recommendations = generateSmartRecommendations(results);
            reportHTML += `
                <hr style="margin: 20px 0; border: 1px solid #e5e7eb;">
                <div class="diagnostic-item">
                    <div class="diagnostic-label">üí° Êô∫ËÉΩÂª∫ËÆÆ</div>
                    <div class="diagnostic-value">
                        ${recommendations.map(rec => `<div style="margin: 4px 0; color: #374151;">‚Ä¢ ${rec}</div>`).join('')}
                    </div>
                </div>
            `;
            
            content.innerHTML = reportHTML;
        }
        
        // ÁîüÊàêÊô∫ËÉΩÊé®Ëçê
        function generateSmartRecommendations(results) {
            const recommendations = [];
            
            // ÊµèËßàÂô®ÂÖºÂÆπÊÄßÂª∫ËÆÆ
            if (!results.browser.details.compatible) {
                recommendations.push('Âª∫ËÆÆ‰ΩøÁî® Chrome„ÄÅEdge Êàñ Firefox ÊµèËßàÂô®‰ª•Ëé∑ÂæóÊúÄ‰Ω≥ Web3 ‰ΩìÈ™å');
            }
            
            // MetaMask Áõ∏ÂÖ≥Âª∫ËÆÆ
            if (!results.metamask.detected) {
                recommendations.push('Âª∫ËÆÆÂÆâË£Ö MetaMask - ÊúÄÂπøÊ≥õÊîØÊåÅÁöÑ‰ª•Â§™ÂùäÈí±ÂåÖ');
            } else if (results.metamask.details.conflicts.length > 0) {
                recommendations.push('Ê£ÄÊµãÂà∞Â§öÈí±ÂåÖÂÜ≤Á™ÅÔºåÂª∫ËÆÆÁ¶ÅÁî®ÂÖ∂‰ªñÈí±ÂåÖÊâ©Â±ï‰ª•ÈÅøÂÖçËøûÊé•ÈóÆÈ¢ò');
            }
            
            // Â§öÈí±ÂåÖÁéØÂ¢ÉÂª∫ËÆÆ
            if (results.web3.details.total > 1) {
                recommendations.push('Ê£ÄÊµãÂà∞Â§ö‰∏™Èí±ÂåÖÊèí‰ª∂ÔºåÂª∫ËÆÆÂè™‰øùÁïô‰∏Ä‰∏™‰∏ªË¶ÅÈí±ÂåÖ‰ª•ÈÅøÂÖçÂÜ≤Á™Å');
            }
            
            // ÁßªÂä®Á´ØÂª∫ËÆÆ
            if (results.browser.details.mobile) {
                recommendations.push('ÁßªÂä®Á´ØÁî®Êà∑Âª∫ËÆÆ‰ΩøÁî®Èí±ÂåÖÂÜÖÁΩÆÊµèËßàÂô®ËÆøÈóÆ DApp');
            }
            
            // Êó†Èí±ÂåÖÂª∫ËÆÆ
            if (results.web3.details.total === 0) {
                recommendations.push('Êú™Ê£ÄÊµãÂà∞‰ªª‰Ωï Web3 Èí±ÂåÖÔºåÂª∫ËÆÆÂÆâË£Ö MetaMask ÊàñÂÖ∂‰ªñÊîØÊåÅÁöÑÈí±ÂåÖ');
            }
            
            // ÊàêÂäüËøûÊé•ÁöÑÊÉÖÂÜµ
            if (results.metamask.detected && results.metamask.details.ready && results.browser.details.compatible) {
                recommendations.push('ÊÇ®ÁöÑÁéØÂ¢ÉÈÖçÁΩÆËâØÂ•ΩÔºåÂèØ‰ª•Ê≠£Â∏∏‰ΩøÁî® FMH ‰ª£Â∏ÅÁÆ°ÁêÜÂäüËÉΩ');
            }
            
            return recommendations;
        }
        
        // ÁÆ°ÁêÜÂäüËÉΩÂáΩÊï∞
        async function refreshContractInfo() {
            if (connector.contract) {
                await connector.refreshContractInfo();
            }
        }
        
        async function mintTokens() {
            try {
                const toAddress = document.getElementById('mintToAddress').value.trim();
                const amount = document.getElementById('mintAmount').value.trim();
                
                if (!toAddress || !amount) {
                    showStatus('mintStatus', 'error', '‚ùå ËØ∑Â°´ÂÜôÂÆåÊï¥ÁöÑÈì∏Â∏Å‰ø°ÊÅØ');
                    return;
                }
                
                if (!ethers.utils.isAddress(toAddress)) {
                    showStatus('mintStatus', 'error', '‚ùå Êé•Êî∂Âú∞ÂùÄÊ†ºÂºèÈîôËØØ');
                    return;
                }
                
                if (parseFloat(amount) <= 0) {
                    showStatus('mintStatus', 'error', '‚ùå Èì∏Â∏ÅÊï∞ÈáèÂøÖÈ°ªÂ§ß‰∫é0');
                    return;
                }
                
                showStatus('mintStatus', 'info', '‚è≥ Ê≠£Âú®Â§ÑÁêÜÈì∏Â∏Å‰∫§ÊòìÔºåËØ∑Âú®Èí±ÂåÖ‰∏≠Á°ÆËÆ§...');
                
                const mintAmount = ethers.utils.parseEther(amount);
                const tx = await connector.contract.mint(toAddress, mintAmount);
                
                showStatus('mintStatus', 'info', `‚è≥ ‰∫§ÊòìÂ∑≤Êèê‰∫§ÔºåÁ≠âÂæÖÁ°ÆËÆ§...<br><small>‰∫§ÊòìÂìàÂ∏å: ${tx.hash}</small>`);
                
                const receipt = await tx.wait();
                showStatus('mintStatus', 'success', `‚úÖ Èì∏Â∏ÅÊàêÂäüÔºÅ<br>Â∑≤Âêë ${toAddress} Èì∏ÈÄ† ${amount} FMH<br><small>GasË¥πÁî®: ${receipt.gasUsed.toString()}</small>`);
                
                document.getElementById('mintToAddress').value = '';
                document.getElementById('mintAmount').value = '';
                await refreshContractInfo();
                
            } catch (error) {
                console.error('Èì∏Â∏ÅÂ§±Ë¥•:', error);
                showStatus('mintStatus', 'error', `‚ùå Èì∏Â∏ÅÂ§±Ë¥•: ${error.message}`);
            }
        }
        
        function toggleBurnInputs() {
            const burnType = document.getElementById('burnType').value;
            const burnFromGroup = document.getElementById('burnFromGroup');
            
            if (burnType === 'burnFrom') {
                burnFromGroup.style.display = 'block';
            } else {
                burnFromGroup.style.display = 'none';
            }
        }
        
        async function burnTokens() {
            try {
                const burnType = document.getElementById('burnType').value;
                const amount = document.getElementById('burnAmount').value.trim();
                
                if (!amount) {
                    showStatus('burnStatus', 'error', '‚ùå ËØ∑ËæìÂÖ•ÈîÄÊØÅÊï∞Èáè');
                    return;
                }
                
                if (parseFloat(amount) <= 0) {
                    showStatus('burnStatus', 'error', '‚ùå ÈîÄÊØÅÊï∞ÈáèÂøÖÈ°ªÂ§ß‰∫é0');
                    return;
                }
                
                const burnAmount = ethers.utils.parseEther(amount);
                let tx;
                
                if (burnType === 'burn') {
                    if (!confirm(`Á°ÆËÆ§Ë¶ÅÈîÄÊØÅÊÇ®ÁöÑ ${amount} FMH ‰ª£Â∏ÅÂêóÔºü\n\n‚ö†Ô∏è Ê≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔºÅ`)) {
                        return;
                    }
                    
                    showStatus('burnStatus', 'warning', '‚è≥ Ê≠£Âú®ÈîÄÊØÅÊÇ®ÁöÑ‰ª£Â∏Å...');
                    tx = await connector.contract.burn(burnAmount);
                    
                } else {
                    const fromAddress = document.getElementById('burnFromAddress').value.trim();
                    
                    if (!fromAddress || !ethers.utils.isAddress(fromAddress)) {
                        showStatus('burnStatus', 'error', '‚ùå ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÁõÆÊ†áÂú∞ÂùÄ');
                        return;
                    }
                    
                    if (!confirm(`Á°ÆËÆ§Ë¶ÅÈîÄÊØÅ ${fromAddress} ÁöÑ ${amount} FMH ‰ª£Â∏ÅÂêóÔºü\n\n‚ö†Ô∏è Ê≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔºÅ`)) {
                        return;
                    }
                    
                    showStatus('burnStatus', 'warning', '‚è≥ Ê≠£Âú®ÈîÄÊØÅÁõÆÊ†áÂú∞ÂùÄÁöÑ‰ª£Â∏Å...');
                    tx = await connector.contract.burnFrom(fromAddress, burnAmount);
                }
                
                showStatus('burnStatus', 'info', `‚è≥ ‰∫§ÊòìÂ∑≤Êèê‰∫§ÔºåÁ≠âÂæÖÁ°ÆËÆ§...<br><small>‰∫§ÊòìÂìàÂ∏å: ${tx.hash}</small>`);
                
                await tx.wait();
                showStatus('burnStatus', 'success', `‚úÖ ‰ª£Â∏ÅÈîÄÊØÅÊàêÂäüÔºÅ<br>Â∑≤ÈîÄÊØÅ ${amount} FMH`);
                
                document.getElementById('burnAmount').value = '';
                document.getElementById('burnFromAddress').value = '';
                await refreshContractInfo();
                
            } catch (error) {
                console.error('ÈîÄÊØÅÂ§±Ë¥•:', error);
                showStatus('burnStatus', 'error', `‚ùå ÈîÄÊØÅÂ§±Ë¥•: ${error.message}`);
            }
        }
        
        function addBatchItem() {
            const batchList = document.getElementById('batchBurnList');
            const newItem = document.createElement('div');
            newItem.className = 'batch-item';
            newItem.innerHTML = `
                <input type="text" placeholder="Âú∞ÂùÄ (0x...)" class="batch-address">
                <input type="number" placeholder="Êï∞Èáè" class="batch-amount" min="0" step="0.001">
                <button class="btn btn-danger btn-small" onclick="removeBatchItem(this)">Âà†Èô§</button>
            `;
            batchList.appendChild(newItem);
        }
        
        function removeBatchItem(button) {
            const batchList = document.getElementById('batchBurnList');
            if (batchList.children.length > 1) {
                button.parentElement.remove();
            } else {
                showStatus('batchBurnStatus', 'warning', '‚ö†Ô∏è Ëá≥Â∞ëÈúÄË¶Å‰øùÁïô‰∏Ä‰∏™È°πÁõÆ');
            }
        }
        
        async function executeBatchBurn() {
            try {
                const batchItems = document.querySelectorAll('.batch-item');
                const addresses = [];
                const amounts = [];
                
                for (let item of batchItems) {
                    const address = item.querySelector('.batch-address').value.trim();
                    const amount = item.querySelector('.batch-amount').value.trim();
                    
                    if (address && amount) {
                        if (!ethers.utils.isAddress(address)) {
                            showStatus('batchBurnStatus', 'error', `‚ùå Âú∞ÂùÄÊ†ºÂºèÈîôËØØ: ${address}`);
                            return;
                        }
                        
                        if (parseFloat(amount) <= 0) {
                            showStatus('batchBurnStatus', 'error', `‚ùå Êï∞ÈáèÂøÖÈ°ªÂ§ß‰∫é0: ${amount}`);
                            return;
                        }
                        
                        addresses.push(address);
                        amounts.push(ethers.utils.parseEther(amount));
                    }
                }
                
                if (addresses.length === 0) {
                    showStatus('batchBurnStatus', 'error', '‚ùå ËØ∑Ëá≥Â∞ëÂ°´ÂÜô‰∏Ä‰∏™ÊúâÊïàÁöÑÂú∞ÂùÄÂíåÊï∞Èáè');
                    return;
                }
                
                const totalAmount = amounts.reduce((sum, amt) => sum.add(amt), ethers.BigNumber.from(0));
                const totalFormatted = ethers.utils.formatEther(totalAmount);
                
                if (!confirm(`Á°ÆËÆ§Ë¶ÅÊâπÈáèÈîÄÊØÅÊÄªÂÖ± ${totalFormatted} FMH ‰ª£Â∏ÅÂêóÔºü\nÊ∂âÂèä ${addresses.length} ‰∏™Âú∞ÂùÄ\n\n‚ö†Ô∏è Ê≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔºÅ`)) {
                    return;
                }
                
                showStatus('batchBurnStatus', 'warning', '‚è≥ Ê≠£Âú®ÊâßË°åÊâπÈáèÈîÄÊØÅ...');
                
                const tx = await connector.contract.batchBurn(addresses, amounts);
                showStatus('batchBurnStatus', 'info', `‚è≥ ‰∫§ÊòìÂ∑≤Êèê‰∫§ÔºåÁ≠âÂæÖÁ°ÆËÆ§...<br><small>‰∫§ÊòìÂìàÂ∏å: ${tx.hash}</small>`);
                
                await tx.wait();
                showStatus('batchBurnStatus', 'success', `‚úÖ ÊâπÈáèÈîÄÊØÅÊàêÂäüÔºÅ<br>ÂÖ±ÈîÄÊØÅ ${totalFormatted} FMH (${addresses.length} ‰∏™Âú∞ÂùÄ)`);
                
                document.querySelectorAll('.batch-address').forEach(input => input.value = '');
                document.querySelectorAll('.batch-amount').forEach(input => input.value = '');
                await refreshContractInfo();
                
            } catch (error) {
                console.error('ÊâπÈáèÈîÄÊØÅÂ§±Ë¥•:', error);
                showStatus('batchBurnStatus', 'error', `‚ùå ÊâπÈáèÈîÄÊØÅÂ§±Ë¥•: ${error.message}`);
            }
        }
        
        async function addMinter() {
            try {
                const minterAddress = document.getElementById('newMinterAddress').value.trim();
                
                if (!minterAddress || !ethers.utils.isAddress(minterAddress)) {
                    showStatus('minterStatus', 'error', '‚ùå ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÂú∞ÂùÄ');
                    return;
                }
                
                showStatus('minterStatus', 'info', '‚è≥ Ê≠£Âú®Ê∑ªÂä†Èì∏Â∏ÅËÄÖ...');
                
                const tx = await connector.contract.addAuthorizedMinter(minterAddress);
                showStatus('minterStatus', 'info', `‚è≥ ‰∫§ÊòìÂ∑≤Êèê‰∫§ÔºåÁ≠âÂæÖÁ°ÆËÆ§...<br><small>‰∫§ÊòìÂìàÂ∏å: ${tx.hash}</small>`);
                
                await tx.wait();
                showStatus('minterStatus', 'success', `‚úÖ Èì∏Â∏ÅËÄÖÊ∑ªÂä†ÊàêÂäüÔºÅ<br>${minterAddress} Áé∞Âú®Êã•ÊúâÈì∏Â∏ÅÊùÉÈôê`);
                
                document.getElementById('newMinterAddress').value = '';
                
            } catch (error) {
                console.error('Ê∑ªÂä†Èì∏Â∏ÅËÄÖÂ§±Ë¥•:', error);
                showStatus('minterStatus', 'error', `‚ùå Ê∑ªÂä†Èì∏Â∏ÅËÄÖÂ§±Ë¥•: ${error.message}`);
            }
        }
        
        async function removeMinter() {
            try {
                const minterAddress = document.getElementById('removeMinterAddress').value.trim();
                
                if (!minterAddress || !ethers.utils.isAddress(minterAddress)) {
                    showStatus('minterStatus', 'error', '‚ùå ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÂú∞ÂùÄ');
                    return;
                }
                
                if (!confirm(`Á°ÆËÆ§Ë¶ÅÁßªÈô§ ${minterAddress} ÁöÑÈì∏Â∏ÅÊùÉÈôêÂêóÔºü`)) {
                    return;
                }
                
                showStatus('minterStatus', 'info', '‚è≥ Ê≠£Âú®ÁßªÈô§Èì∏Â∏ÅËÄÖ...');
                
                const tx = await connector.contract.removeAuthorizedMinter(minterAddress);
                await tx.wait();
                
                showStatus('minterStatus', 'success', `‚úÖ Èì∏Â∏ÅËÄÖÁßªÈô§ÊàêÂäüÔºÅ<br>${minterAddress} ÁöÑÈì∏Â∏ÅÊùÉÈôêÂ∑≤Ë¢´Êí§ÈîÄ`);
                
                document.getElementById('removeMinterAddress').value = '';
                
            } catch (error) {
                console.error('ÁßªÈô§Èì∏Â∏ÅËÄÖÂ§±Ë¥•:', error);
                showStatus('minterStatus', 'error', `‚ùå ÁßªÈô§Èì∏Â∏ÅËÄÖÂ§±Ë¥•: ${error.message}`);
            }
        }
        
        async function checkMinterPermission() {
            try {
                const checkAddress = document.getElementById('checkMinterAddress').value.trim();
                
                if (!checkAddress || !ethers.utils.isAddress(checkAddress)) {
                    showStatus('minterStatus', 'error', '‚ùå ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÂú∞ÂùÄ');
                    return;
                }
                
                const isMinter = await connector.contract.isAuthorizedMinter(checkAddress);
                
                let statusText = `üîç ÊùÉÈôêÊü•ËØ¢ÁªìÊûú:<br><strong>Âú∞ÂùÄ:</strong> ${checkAddress}<br>`;
                statusText += `<strong>Èì∏Â∏ÅÊùÉÈôê:</strong> ${isMinter ? '‚úÖ ÊòØ' : '‚ùå Âê¶'}`;
                
                showStatus('minterStatus', 'info', statusText);
                
            } catch (error) {
                console.error('ÊùÉÈôêÊ£ÄÊü•Â§±Ë¥•:', error);
                showStatus('minterStatus', 'error', `‚ùå ÊùÉÈôêÊ£ÄÊü•Â§±Ë¥•: ${error.message}`);
            }
        }
        
        async function queryBalance() {
            try {
                const queryAddr = document.getElementById('queryAddress').value.trim();
                
                if (!queryAddr || !ethers.utils.isAddress(queryAddr)) {
                    showStatus('queryResults', 'error', '‚ùå ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÂú∞ÂùÄ');
                    return;
                }
                
                showLoading('queryResults');
                
                const balance = await connector.contract.balanceOf(queryAddr);
                
                showStatus('queryResults', 'info', `üí∞ ‰ΩôÈ¢ùÊü•ËØ¢ÁªìÊûú:<br><strong>Âú∞ÂùÄ:</strong> ${queryAddr}<br><strong>FMH‰ΩôÈ¢ù:</strong> ${connector.formatToken(balance)}`);
                
            } catch (error) {
                console.error('‰ΩôÈ¢ùÊü•ËØ¢Â§±Ë¥•:', error);
                showStatus('queryResults', 'error', `‚ùå ‰ΩôÈ¢ùÊü•ËØ¢Â§±Ë¥•: ${error.message}`);
            }
        }
        
        async function getBurnRate() {
            try {
                showLoading('queryResults');
                
                const [totalSupply, totalBurned, burnRate] = await Promise.all([
                    connector.contract.totalSupply(),
                    connector.contract.getTotalBurned(),
                    connector.contract.getBurnRate()
                ]);
                
                let resultText = `üìà ÈîÄÊØÅÁªüËÆ°‰ø°ÊÅØ:<br>`;
                resultText += `<strong>ÊÄª‰æõÂ∫îÈáè:</strong> ${connector.formatToken(totalSupply)}<br>`;
                resultText += `<strong>Â∑≤ÈîÄÊØÅÊï∞Èáè:</strong> ${connector.formatToken(totalBurned)}<br>`;
                resultText += `<strong>ÈîÄÊØÅÁéá:</strong> ${(burnRate / 100).toFixed(2)}%`;
                
                showStatus('queryResults', 'info', resultText);
                
            } catch (error) {
                console.error('Ëé∑ÂèñÈîÄÊØÅÁéáÂ§±Ë¥•:', error);
                showStatus('queryResults', 'error', `‚ùå Ëé∑ÂèñÈîÄÊØÅÁéáÂ§±Ë¥•: ${error.message}`);
            }
        }
        
        async function setGameContract() {
            try {
                const gameAddress = document.getElementById('gameContractAddress').value.trim();
                
                if (!gameAddress || !ethers.utils.isAddress(gameAddress)) {
                    showStatus('settingsStatus', 'error', '‚ùå ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊ∏∏ÊàèÂêàÁ∫¶Âú∞ÂùÄ');
                    return;
                }
                
                if (!confirm(`Á°ÆËÆ§Ë¶ÅËÆæÁΩÆÊ∏∏ÊàèÂêàÁ∫¶Âú∞ÂùÄ‰∏∫:\n${gameAddress}\n\nËøôÂ∞ÜÂΩ±ÂìçÊ∏∏ÊàèÁõ∏ÂÖ≥ÁöÑ‰ª£Â∏ÅÊìç‰Ωú„ÄÇ`)) {
                    return;
                }
                
                showStatus('settingsStatus', 'info', '‚è≥ Ê≠£Âú®Êõ¥Êñ∞Ê∏∏ÊàèÂêàÁ∫¶Âú∞ÂùÄ...');
                
                const tx = await connector.contract.setMinesweeperGame(gameAddress);
                showStatus('settingsStatus', 'info', `‚è≥ ‰∫§ÊòìÂ∑≤Êèê‰∫§ÔºåÁ≠âÂæÖÁ°ÆËÆ§...<br><small>‰∫§ÊòìÂìàÂ∏å: ${tx.hash}</small>`);
                
                await tx.wait();
                showStatus('settingsStatus', 'success', `‚úÖ Ê∏∏ÊàèÂêàÁ∫¶Âú∞ÂùÄËÆæÁΩÆÊàêÂäüÔºÅ<br>Êñ∞Âú∞ÂùÄ: ${gameAddress}`);
                
                document.getElementById('gameContractAddress').value = '';
                await refreshContractInfo();
                
            } catch (error) {
                console.error('ËÆæÁΩÆÊ∏∏ÊàèÂêàÁ∫¶Â§±Ë¥•:', error);
                showStatus('settingsStatus', 'error', `‚ùå ËÆæÁΩÆÊ∏∏ÊàèÂêàÁ∫¶Â§±Ë¥•: ${error.message}`);
            }
        }
        
        async function getCurrentGameContract() {
            try {
                showLoading('settingsStatus');
                
                const gameContract = await connector.contract.minesweeperGame();
                
                let statusText = `üéÆ ÂΩìÂâçÊ∏∏ÊàèÂêàÁ∫¶‰ø°ÊÅØ:<br><strong>Âú∞ÂùÄ:</strong> `;
                if (gameContract === '0x0000000000000000000000000000000000000000') {
                    statusText += 'Êú™ËÆæÁΩÆÊ∏∏ÊàèÂêàÁ∫¶';
                } else {
                    statusText += gameContract;
                }
                
                showStatus('settingsStatus', 'info', statusText);
                
            } catch (error) {
                console.error('Êü•ËØ¢Ê∏∏ÊàèÂêàÁ∫¶Â§±Ë¥•:', error);
                showStatus('settingsStatus', 'error', `‚ùå Êü•ËØ¢Ê∏∏ÊàèÂêàÁ∫¶Â§±Ë¥•: ${error.message}`);
            }
        }
        
        // Â∑•ÂÖ∑ÂáΩÊï∞
        function showStatus(elementId, type, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `<div class="status ${type}">${message}</div>`;
            }
        }
        
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `<div class="status info"><div style="display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px;"></div>Ê≠£Âú®Âä†ËΩΩ...</div>`;
            }
        }
        
        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        window.addEventListener('load', () => {
            connector.addLog('info', 'È°µÈù¢Âä†ËΩΩÂÆåÊàêÔºåÊô∫ËÉΩËøûÊé•Á≥ªÁªüÂ∑≤Â∞±Áª™');
        });
    </script>
</body>
</html>