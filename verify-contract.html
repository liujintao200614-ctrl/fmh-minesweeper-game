<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆçº¦åœ°å€éªŒè¯å·¥å…·</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .input-group { margin: 20px 0; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        .input-group input { width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; }
        .input-group input:focus { outline: none; border-color: #007bff; }
        .btn { background: #007bff; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .result { margin: 20px 0; padding: 15px; border-radius: 8px; border-left: 4px solid; }
        .result.success { background: #d4edda; color: #155724; border-color: #28a745; }
        .result.error { background: #f8d7da; color: #721c24; border-color: #dc3545; }
        .result.info { background: #d1ecf1; color: #0c5460; border-color: #17a2b8; }
        .contract-info { background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0; }
        .contract-info h4 { margin: 0 0 10px 0; color: #495057; }
        .function-list { max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” FMHåˆçº¦åœ°å€éªŒè¯å·¥å…·</h1>
        <p>éªŒè¯åˆçº¦åœ°å€æ˜¯å¦æ­£ç¡®ï¼Œæ£€æŸ¥åˆçº¦å‡½æ•°å’Œç½‘ç»œè¿æ¥çŠ¶æ€</p>
        
        <div class="input-group">
            <label for="contractAddress">åˆçº¦åœ°å€:</label>
            <input type="text" id="contractAddress" placeholder="è¾“å…¥åˆçº¦åœ°å€ (0x...)" value="0xFa32A01E4FDAde90204902EDfEa63C150407C736">
        </div>
        
        <div>
            <button class="btn" onclick="verifyContract()">ğŸ” éªŒè¯åˆçº¦</button>
            <button class="btn btn-success" onclick="connectWallet()">ğŸ”— è¿æ¥é’±åŒ…</button>
            <button class="btn btn-danger" onclick="clearResults()">ğŸ§¹ æ¸…é™¤ç»“æœ</button>
        </div>
        
        <div id="walletStatus"></div>
        <div id="verificationResult"></div>
    </div>

    <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script>
        let provider, signer, userAddress;
        const MONAD_CHAIN_ID = "0x279F";
        
        function showResult(elementId, type, message) {
            document.getElementById(elementId).innerHTML = `<div class="result ${type}">${message}</div>`;
        }
        
        function clearResults() {
            document.getElementById('verificationResult').innerHTML = '';
            document.getElementById('walletStatus').innerHTML = '';
        }
        
        async function connectWallet() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    showResult('walletStatus', 'error', 'âŒ MetaMaskæœªå®‰è£…');
                    return;
                }
                
                showResult('walletStatus', 'info', 'â³ æ­£åœ¨è¿æ¥é’±åŒ…...');
                
                // è¯·æ±‚è¿æ¥
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                // æ£€æŸ¥ç½‘ç»œ
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                if (chainId !== MONAD_CHAIN_ID) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: MONAD_CHAIN_ID }],
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: MONAD_CHAIN_ID,
                                    chainName: 'Monad Testnet',
                                    nativeCurrency: { name: 'MON', symbol: 'MON', decimals: 18 },
                                    rpcUrls: ['https://testnet-rpc.monad.xyz'],
                                    blockExplorerUrls: ['https://testnet-explorer.monad.xyz']
                                }]
                            });
                        }
                    }
                }
                
                provider = new ethers.BrowserProvider(window.ethereum, {
                    name: 'Monad Testnet',
                    chainId: 10143,
                    ensAddress: null, // ç¦ç”¨ ENS è§£æ
                });
                signer = await provider.getSigner();
                userAddress = await signer.getAddress();
                
                showResult('walletStatus', 'success', `âœ… é’±åŒ…è¿æ¥æˆåŠŸ<br><strong>åœ°å€:</strong> ${userAddress}<br><strong>ç½‘ç»œ:</strong> Monadæµ‹è¯•ç½‘`);
                
            } catch (error) {
                showResult('walletStatus', 'error', `âŒ è¿æ¥å¤±è´¥: ${error.message}`);
            }
        }
        
        async function verifyContract() {
            const contractAddress = document.getElementById('contractAddress').value.trim();
            
            if (!contractAddress) {
                showResult('verificationResult', 'error', 'âŒ è¯·è¾“å…¥åˆçº¦åœ°å€');
                return;
            }
            
            if (!ethers.utils.isAddress(contractAddress)) {
                showResult('verificationResult', 'error', 'âŒ åˆçº¦åœ°å€æ ¼å¼é”™è¯¯');
                return;
            }
            
            if (!provider) {
                showResult('verificationResult', 'error', 'âŒ è¯·å…ˆè¿æ¥é’±åŒ…');
                return;
            }
            
            showResult('verificationResult', 'info', 'â³ æ­£åœ¨éªŒè¯åˆçº¦...');
            
            try {
                let resultHTML = `<div class="contract-info">`;
                resultHTML += `<h4>ğŸ“‹ åˆçº¦éªŒè¯ç»“æœ</h4>`;
                resultHTML += `<strong>åœ°å€:</strong> ${contractAddress}<br>`;
                
                // 1. æ£€æŸ¥åœ°å€æ˜¯å¦æ˜¯åˆçº¦
                const code = await provider.getCode(contractAddress);
                if (code === '0x') {
                    showResult('verificationResult', 'error', `âŒ åœ°å€ä¸æ˜¯åˆçº¦<br>è¿™ä¸ªåœ°å€æ²¡æœ‰éƒ¨ç½²ä»»ä½•åˆçº¦ä»£ç `);
                    return;
                }
                
                resultHTML += `<strong>åˆçº¦ä»£ç :</strong> âœ… å­˜åœ¨ (${code.length} å­—èŠ‚)<br>`;
                
                // 2. æµ‹è¯•ERC20åŸºç¡€å‡½æ•°
                const erc20ABI = [
                    "function name() view returns (string)",
                    "function symbol() view returns (string)", 
                    "function decimals() view returns (uint8)",
                    "function totalSupply() view returns (uint256)",
                    "function balanceOf(address) view returns (uint256)"
                ];
                
                const contract = new ethers.Contract(contractAddress, erc20ABI, provider);
                
                try {
                    const name = await contract.name();
                    resultHTML += `<strong>ä»£å¸åç§°:</strong> ${name}<br>`;
                } catch (e) {
                    resultHTML += `<strong>ä»£å¸åç§°:</strong> âŒ æ— æ³•è·å– (${e.message})<br>`;
                }
                
                try {
                    const symbol = await contract.symbol();
                    resultHTML += `<strong>ä»£å¸ç¬¦å·:</strong> ${symbol}<br>`;
                } catch (e) {
                    resultHTML += `<strong>ä»£å¸ç¬¦å·:</strong> âŒ æ— æ³•è·å–<br>`;
                }
                
                try {
                    const decimals = await contract.decimals();
                    resultHTML += `<strong>å°æ•°ä½æ•°:</strong> ${decimals}<br>`;
                } catch (e) {
                    resultHTML += `<strong>å°æ•°ä½æ•°:</strong> âŒ æ— æ³•è·å–<br>`;
                }
                
                try {
                    const totalSupply = await contract.totalSupply();
                    resultHTML += `<strong>æ€»ä¾›åº”é‡:</strong> ${ethers.utils.formatEther(totalSupply)}<br>`;
                } catch (e) {
                    resultHTML += `<strong>æ€»ä¾›åº”é‡:</strong> âŒ æ— æ³•è·å–<br>`;
                }
                
                // 3. æµ‹è¯•FMHç‰¹æœ‰å‡½æ•°
                const fmhABI = [
                    "function isOwner(address) view returns (bool)",
                    "function isAuthorizedMinter(address) view returns (bool)",
                    "function getRemainingSupply() view returns (uint256)",
                    "function getTotalBurned() view returns (uint256)",
                    "function minesweeperGame() view returns (address)"
                ];
                
                const fmhContract = new ethers.Contract(contractAddress, fmhABI, provider);
                
                try {
                    const remainingSupply = await fmhContract.getRemainingSupply();
                    resultHTML += `<strong>å‰©ä½™ä¾›åº”é‡:</strong> ${ethers.utils.formatEther(remainingSupply)}<br>`;
                } catch (e) {
                    resultHTML += `<strong>å‰©ä½™ä¾›åº”é‡:</strong> âŒ ä¸æ˜¯FMHåˆçº¦æˆ–å‡½æ•°ä¸å­˜åœ¨<br>`;
                }
                
                if (userAddress) {
                    try {
                        const isOwner = await fmhContract.isOwner(userAddress);
                        const isMinter = await fmhContract.isAuthorizedMinter(userAddress);
                        resultHTML += `<strong>å½“å‰ç”¨æˆ·æƒé™:</strong><br>`;
                        resultHTML += `&nbsp;&nbsp;Owner: ${isOwner ? 'âœ… æ˜¯' : 'âŒ å¦'}<br>`;
                        resultHTML += `&nbsp;&nbsp;Minter: ${isMinter ? 'âœ… æ˜¯' : 'âŒ å¦'}<br>`;
                    } catch (e) {
                        resultHTML += `<strong>æƒé™æ£€æŸ¥:</strong> âŒ æ— æ³•æ£€æŸ¥<br>`;
                    }
                }
                
                // 4. ç½‘ç»œä¿¡æ¯
                const chainIdHex = await provider.send('eth_chainId', []);
                const chainId = parseInt(chainIdHex, 16);
                resultHTML += `<strong>ç½‘ç»œä¿¡æ¯:</strong><br>`;
                resultHTML += `&nbsp;&nbsp;Chain ID: ${chainId}<br>`;
                resultHTML += `&nbsp;&nbsp;ç½‘ç»œåç§°: Monad Testnet<br>`;
                
                resultHTML += `</div>`;
                
                // 5. æµ‹è¯•å»ºè®®
                resultHTML += `<div class="contract-info">`;
                resultHTML += `<h4>ğŸ’¡ æµ‹è¯•å»ºè®®</h4>`;
                if (code !== '0x') {
                    resultHTML += `âœ… åˆçº¦åœ°å€æœ‰æ•ˆï¼Œå¯ä»¥ä½¿ç”¨<br>`;
                    resultHTML += `âœ… å»ºè®®åœ¨ç®¡ç†é¢æ¿ä¸­ä½¿ç”¨æ­¤åœ°å€<br>`;
                } else {
                    resultHTML += `âŒ åˆçº¦åœ°å€æ— æ•ˆï¼Œè¯·æ£€æŸ¥<br>`;
                }
                resultHTML += `</div>`;
                
                showResult('verificationResult', 'success', resultHTML);
                
            } catch (error) {
                console.error('éªŒè¯å¤±è´¥:', error);
                let errorMsg = `âŒ åˆçº¦éªŒè¯å¤±è´¥:<br><br>`;
                errorMsg += `<strong>é”™è¯¯ç±»å‹:</strong> ${error.code || 'Unknown'}<br>`;
                errorMsg += `<strong>é”™è¯¯ä¿¡æ¯:</strong> ${error.message}<br><br>`;
                
                errorMsg += `<strong>å¯èƒ½åŸå› :</strong><br>`;
                errorMsg += `â€¢ åˆçº¦åœ°å€ä¸å­˜åœ¨<br>`;
                errorMsg += `â€¢ ç½‘ç»œè¿æ¥é—®é¢˜<br>`;
                errorMsg += `â€¢ RPCèŠ‚ç‚¹å“åº”å¼‚å¸¸<br>`;
                errorMsg += `â€¢ åˆçº¦ä¸æ˜¯ERC20ä»£å¸<br><br>`;
                
                errorMsg += `<strong>è§£å†³å»ºè®®:</strong><br>`;
                errorMsg += `â€¢ æ£€æŸ¥åˆçº¦åœ°å€æ˜¯å¦æ­£ç¡®<br>`;
                errorMsg += `â€¢ ç¡®è®¤åœ¨æ­£ç¡®çš„ç½‘ç»œï¼ˆMonadæµ‹è¯•ç½‘ï¼‰<br>`;
                errorMsg += `â€¢ å°è¯•åˆ·æ–°é¡µé¢é‡æ–°è¿æ¥<br>`;
                errorMsg += `â€¢ åœ¨åŒºå—æµè§ˆå™¨ä¸­æŸ¥çœ‹åˆçº¦`;
                
                showResult('verificationResult', 'error', errorMsg);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿æ¥ï¼ˆå¦‚æœå·²ç»è¿æ¥è¿‡ï¼‰
        window.addEventListener('load', async () => {
            if (typeof window.ethereum !== 'undefined' && window.ethereum.selectedAddress) {
                try {
                    await connectWallet();
                } catch (error) {
                    console.log('è‡ªåŠ¨è¿æ¥å¤±è´¥');
                }
            }
        });
    </script>
</body>
</html>