# 🔐 私钥安全指南

## ⚠️ 重要安全提醒

### 1. 私钥管理原则

- **绝不**在代码中硬编码私钥
- **绝不**将 `.env.local` 文件提交到 Git
- **绝不**在公共场合分享私钥
- **务必**使用不同的私钥用于不同目的

### 2. 当前项目需要的私钥

#### PRIVATE_KEY (部署私钥)
- **用途**: 仅用于智能合约部署
- **权限**: 需要有足够的 MON 代币支付 Gas 费用
- **安全级别**: 中等（部署后可停用）

#### SERVER_PRIVATE_KEY (服务器私钥) 
- **用途**: 后端自动处理奖励发放
- **权限**: 需要有 MON 代币支付交易费用
- **安全级别**: 高（长期运行，需严格保护）

### 3. 生产环境安全建议

#### 🔒 私钥分离策略
```bash
# 开发环境
PRIVATE_KEY=开发测试私钥
SERVER_PRIVATE_KEY=开发测试私钥

# 生产环境  
PRIVATE_KEY=生产部署私钥（部署后可删除）
SERVER_PRIVATE_KEY=生产服务器私钥（严格保护）
```

#### 🔒 权限最小化
- 部署私钥：仅在部署时使用，之后立即停用
- 服务器私钥：仅给予必要的代币数量，定期监控

#### 🔒 多重签名建议
- 生产环境建议使用多重签名钱包
- 重要操作需要多人确认

### 4. 安全检查清单

#### ✅ 部署前检查
- [ ] `.env.local` 已添加到 `.gitignore`
- [ ] 代码中无硬编码私钥
- [ ] 使用不同私钥用于不同目的
- [ ] 私钥对应账户有足够代币

#### ✅ 运行时安全
- [ ] 服务器私钥定期轮换
- [ ] 监控账户余额和交易
- [ ] 设置异常交易告警
- [ ] 定期审计代码和权限

### 5. 紧急响应

#### 🚨 私钥泄露处理
1. **立即停用** 泄露的私钥
2. **转移资金** 到新的安全账户
3. **更新配置** 使用新私钥
4. **审查日志** 检查是否有异常交易
5. **通知团队** 相关安全事件

#### 🚨 异常交易检测
- 监控账户余额变化
- 检查未授权的合约调用
- 设置交易频率告警

### 6. 最佳实践

#### 💡 开发环境
- 使用测试网络和测试代币
- 定期更换测试私钥
- 不要在测试环境中使用真实资金

#### 💡 生产环境
- 使用硬件钱包或 HSM
- 实施多重签名策略
- 定期安全审计
- 建立事件响应流程

### 7. 环境变量模板

```bash
# .env.local (生产环境)
PRIVATE_KEY=your_deployment_private_key_64_chars
SERVER_PRIVATE_KEY=your_server_private_key_64_chars
MONAD_RPC_URL=https://testnet-rpc.monad.xyz
NEXTAUTH_URL=https://yourdomain.com
NEXT_PUBLIC_MINESWEEPER_CONTRACT=0x...
NEXT_PUBLIC_FMH_TOKEN_CONTRACT=0x...
```

### 8. 监控和告警

建议设置以下监控：
- 账户余额低于阈值告警
- 异常大额交易告警  
- API 调用频率异常告警
- 合约交互失败率告警

---

## 📞 如遇安全问题

如发现任何安全漏洞或异常，请立即：
1. 停止相关服务
2. 保护私钥安全
3. 联系开发团队
4. 记录事件详情

**记住：安全无小事，预防胜于补救！** 🛡️