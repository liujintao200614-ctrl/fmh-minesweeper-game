# 🚨 应急关闭游戏指南

## ⚠️ 什么时候需要紧急关闭游戏？

### 紧急情况：
- 发现安全漏洞或被攻击
- 私钥可能泄露
- 发现代码严重bug
- 法律合规问题
- 服务器异常或过载

## 🛑 立即关闭步骤（按顺序执行）

### 1. 关闭公网访问（立即生效）
```bash
# 方法1：关闭ngrok隧道
# 在运行ngrok的终端按 Ctrl+C 停止

# 方法2：关闭游戏服务器
pkill -f "next start"
pkill -f "npm run start"

# 方法3：关闭所有相关进程
pkill -f ngrok
pkill -f cloudflared
pkill -f localtunnel
```

### 2. 暂停智能合约（如需要）
```bash
# 如果合约有pause功能，通过以下方式暂停
cd "/Users/liujintao/扫雷游戏2.0"
# 使用hardhat控制台或脚本暂停合约
npx hardhat console --network monad-testnet
```

### 3. 备份重要数据
```bash
# 备份游戏数据和日志
cp -r "/Users/liujintao/扫雷游戏2.0" "/Users/liujintao/游戏备份_$(date +%Y%m%d_%H%M%S)"

# 导出重要配置
cat .env.local > backup_env_$(date +%Y%m%d_%H%M%S).txt
```

## 📱 通知用户方案

### 立即通知渠道：
1. **更新邀请链接为维护页面**
2. **在群聊/朋友圈发布公告**
3. **准备客服回复模板**

### 用户通知模板：
```
🔧 【FMH扫雷游戏维护通知】

亲爱的玩家们：

由于系统维护/安全检查，游戏暂时关闭。

⏰ 预计恢复时间：[具体时间]
📞 有问题请联系：[您的联系方式]
💰 游戏中的资产安全，请放心

感谢理解！🙏
```

## 🔧 快速恢复检查清单

### 恢复前必须确认：
- [ ] 安全问题已解决
- [ ] 代码bug已修复
- [ ] 私钥仍然安全
- [ ] 合约状态正常
- [ ] 服务器资源充足

### 恢复步骤：
1. **重启游戏服务器**
   ```bash
   cd "/Users/liujintao/扫雷游戏2.0"
   npm run start
   ```

2. **重新建立公网连接**
   ```bash
   # 使用ngrok
   ngrok http 3000
   
   # 或使用cloudflare
   cloudflared tunnel --url localhost:3000
   ```

3. **测试所有功能**
   - 钱包连接
   - 游戏开始
   - 奖励发放
   - 数据同步

4. **通知用户恢复**

## 📋 应急联系信息

### 技术支持：
- 开发者：[您的联系方式]
- 紧急邮箱：[应急邮箱]
- 技术群：[技术支持群]

### 重要链接：
- Monad测试网浏览器：https://testnet-explorer.monad.xyz
- FMH Token合约：0x83aB028468ef2a5495Cc7964B3266437956231E2
- 游戏合约：0x4bE377d2bf2b3412b6eBF1b179314fd90adf9C27

## 🚨 极端情况处理

### 如果私钥完全泄露：
1. **立即转移所有资金**
2. **撤销合约owner权限**
3. **通知所有用户停止使用**
4. **考虑重新部署整个系统**

### 如果发现严重安全漏洞：
1. **立即关闭服务**
2. **不要公开漏洞详情**
3. **联系安全专家**
4. **修复后进行安全审计**

---

## 🛡️ 预防措施

### 日常监控：
- 定期检查服务器状态
- 监控钱包余额和交易
- 关注用户反馈
- 备份重要数据

### 安全提升：
- 定期更新依赖
- 进行代码审计
- 实施访问控制
- 准备灾难恢复

---

**记住：宁可谨慎过度，也不要掉以轻心！**

最后更新：$(date)
下次检查：________________